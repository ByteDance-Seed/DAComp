import{R as g,i as y,d as l,j as f,k as v,l as C,t as m,c as b,C as w,n as S,e as U,m as F,o as r,A as k}from"./open-hands-axios-BeOZUmy8.js";var A=class extends g{#i;#n;#e;#a;#t;#o;#r;constructor(a){super(),this.#r=!1,this.#o=a.defaultOptions,this.setOptions(a.options),this.observers=[],this.#a=a.client,this.#e=this.#a.getQueryCache(),this.queryKey=a.queryKey,this.queryHash=a.queryHash,this.#i=R(this.options),this.state=a.state??this.#i,this.scheduleGc()}get meta(){return this.options.meta}get promise(){return this.#t?.promise}setOptions(a){this.options={...this.#o,...a},this.updateGcTime(this.options.gcTime)}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&this.#e.remove(this)}setData(a,t){const e=y(this.state.data,a,this.options);return this.#s({data:e,type:"success",dataUpdatedAt:t?.updatedAt,manual:t?.manual}),e}setState(a,t){this.#s({type:"setState",state:a,setStateOptions:t})}cancel(a){const t=this.#t?.promise;return this.#t?.cancel(a),t?t.then(l).catch(l):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(this.#i)}isActive(){return this.observers.some(a=>f(a.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===v||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(a=>C(a.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(a=>a.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(a=0){return this.state.data===void 0?!0:a==="static"?!1:this.state.isInvalidated?!0:!m(this.state.dataUpdatedAt,a)}onFocus(){this.observers.find(t=>t.shouldFetchOnWindowFocus())?.refetch({cancelRefetch:!1}),this.#t?.continue()}onOnline(){this.observers.find(t=>t.shouldFetchOnReconnect())?.refetch({cancelRefetch:!1}),this.#t?.continue()}addObserver(a){this.observers.includes(a)||(this.observers.push(a),this.clearGcTimeout(),this.#e.notify({type:"observerAdded",query:this,observer:a}))}removeObserver(a){this.observers.includes(a)&&(this.observers=this.observers.filter(t=>t!==a),this.observers.length||(this.#t&&(this.#r?this.#t.cancel({revert:!0}):this.#t.cancelRetry()),this.scheduleGc()),this.#e.notify({type:"observerRemoved",query:this,observer:a}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||this.#s({type:"invalidate"})}async fetch(a,t){if(this.state.fetchStatus!=="idle"&&this.#t?.status()!=="rejected"){if(this.state.data!==void 0&&t?.cancelRefetch)this.cancel({silent:!0});else if(this.#t)return this.#t.continueRetry(),this.#t.promise}if(a&&this.setOptions(a),!this.options.queryFn){const n=this.observers.find(u=>u.options.queryFn);n&&this.setOptions(n.options)}const e=new AbortController,s=n=>{Object.defineProperty(n,"signal",{enumerable:!0,get:()=>(this.#r=!0,e.signal)})},i=()=>{const n=U(this.options,t),h=(()=>{const d={client:this.#a,queryKey:this.queryKey,meta:this.meta};return s(d),d})();return this.#r=!1,this.options.persister?this.options.persister(n,h,this):n(h)},o=(()=>{const n={fetchOptions:t,options:this.options,queryKey:this.queryKey,client:this.#a,state:this.state,fetchFn:i};return s(n),n})();this.options.behavior?.onFetch(o,this),this.#n=this.state,(this.state.fetchStatus==="idle"||this.state.fetchMeta!==o.fetchOptions?.meta)&&this.#s({type:"fetch",meta:o.fetchOptions?.meta}),this.#t=b({initialPromise:t?.initialPromise,fn:o.fetchFn,abort:e.abort.bind(e),onFail:(n,u)=>{this.#s({type:"failed",failureCount:n,error:u})},onPause:()=>{this.#s({type:"pause"})},onContinue:()=>{this.#s({type:"continue"})},retry:o.options.retry,retryDelay:o.options.retryDelay,networkMode:o.options.networkMode,canRun:()=>!0});try{const n=await this.#t.start();if(n===void 0)throw new Error(`${this.queryHash} data is undefined`);return this.setData(n),this.#e.config.onSuccess?.(n,this),this.#e.config.onSettled?.(n,this.state.error,this),n}catch(n){if(n instanceof w){if(n.silent)return this.#t.promise;if(n.revert)return this.setState({...this.#n,fetchStatus:"idle"}),this.state.data}throw this.#s({type:"error",error:n}),this.#e.config.onError?.(n,this),this.#e.config.onSettled?.(this.state.data,n,this),n}finally{this.scheduleGc()}}#s(a){const t=e=>{switch(a.type){case"failed":return{...e,fetchFailureCount:a.failureCount,fetchFailureReason:a.error};case"pause":return{...e,fetchStatus:"paused"};case"continue":return{...e,fetchStatus:"fetching"};case"fetch":return{...e,...$(e.data,this.options),fetchMeta:a.meta??null};case"success":const s={...e,data:a.data,dataUpdateCount:e.dataUpdateCount+1,dataUpdatedAt:a.dataUpdatedAt??Date.now(),error:null,isInvalidated:!1,status:"success",...!a.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};return this.#n=a.manual?s:void 0,s;case"error":const i=a.error;return{...e,error:i,errorUpdateCount:e.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:e.fetchFailureCount+1,fetchFailureReason:i,fetchStatus:"idle",status:"error"};case"invalidate":return{...e,isInvalidated:!0};case"setState":return{...e,...a.state}}};this.state=t(this.state),S.batch(()=>{this.observers.forEach(e=>{e.onQueryUpdate()}),this.#e.notify({query:this,type:"updated",action:a})})}};function $(a,t){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:F(t.networkMode)?"fetching":"paused",...a===void 0&&{error:null,status:"pending"}}}function R(a){const t=typeof a.initialData=="function"?a.initialData():a.initialData,e=t!==void 0,s=e?typeof a.initialDataUpdatedAt=="function"?a.initialDataUpdatedAt():a.initialDataUpdatedAt:0;return{data:t,dataUpdateCount:0,dataUpdatedAt:e?s??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:e?"success":"pending",fetchStatus:"idle"}}const p=a=>{const t=/<[^>]*[?&]page=(\d+)(?:&[^>]*)?>; rel="next"/,e=a.match(t);return e?parseInt(e[1],10):null};class D{static currentConversation=null;static getCurrentConversation(){return this.currentConversation}static setCurrentConversation(t){this.currentConversation=t}static getConversationUrl(t){return this.currentConversation?.conversation_id===t&&this.currentConversation.url?this.currentConversation.url:`/api/conversations/${t}`}static async getModels(){const{data:t}=await r.get("/api/options/models");return t}static async getAgents(){const{data:t}=await r.get("/api/options/agents");return t}static async getSecurityAnalyzers(){const{data:t}=await r.get("/api/options/security-analyzers");return t}static async getConfig(){const{data:t}=await r.get("/api/options/config");return t}static getConversationHeaders(){const t=new k,e=this.currentConversation?.session_api_key;return e&&t.set("X-Session-API-Key",e),t}static async submitFeedback(t,e){const s=`/api/conversations/${t}/submit-feedback`,{data:i}=await r.post(s,e);return i}static async submitConversationFeedback(t,e,s,i){const c="/feedback/conversation",o={conversation_id:t,event_id:s,rating:e,reason:i,metadata:{source:"likert-scale"}},{data:n}=await r.post(c,o);return n}static async checkFeedbackExists(t,e){try{const s=`/feedback/conversation/${t}/${e}`,{data:i}=await r.get(s);return i}catch{return{exists:!1}}}static async getBatchFeedback(t){const e=`/feedback/conversation/${t}/batch`,{data:s}=await r.get(e);return s}static async authenticate(t){return t==="oss"||await r.post("/api/authenticate"),!0}static async getWorkspaceZip(t){const e=`${this.getConversationUrl(t)}/zip-directory`;return(await r.get(e,{responseType:"blob",headers:this.getConversationHeaders()})).data}static async getWebHosts(t){const e=`${this.getConversationUrl(t)}/web-hosts`,s=await r.get(e,{headers:this.getConversationHeaders()});return Object.keys(s.data.hosts)}static async getGitHubAccessToken(t){const{data:e}=await r.post("/api/keycloak/callback",{code:t});return e}static async getVSCodeUrl(t){const e=`${this.getConversationUrl(t)}/vscode-url`,{data:s}=await r.get(e,{headers:this.getConversationHeaders()});return s}static async getRuntimeId(t){const e=`${this.getConversationUrl(t)}/config`,{data:s}=await r.get(e,{headers:this.getConversationHeaders()});return s}static async getUserConversations(t=20,e){const s=new URLSearchParams;s.append("limit",t.toString()),e&&s.append("page_id",e);const{data:i}=await r.get(`/api/conversations?${s.toString()}`);return i}static async searchConversations(t,e,s=100){const i=new URLSearchParams;i.append("limit",s.toString()),t&&i.append("selected_repository",t),e&&i.append("conversation_trigger",e);const{data:c}=await r.get(`/api/conversations?${i.toString()}`);return c.results}static async deleteUserConversation(t){await r.delete(`/api/conversations/${t}`)}static async createConversation(t,e,s,i,c,o,n){const u={repository:t,git_provider:e,selected_branch:c,initial_user_msg:s,suggested_task:i,conversation_instructions:o,create_microagent:n},{data:h}=await r.post("/api/conversations",u);return h}static async getConversation(t){const{data:e}=await r.get(`/api/conversations/${t}`);return e}static async startConversation(t,e){const{data:s}=await r.post(`/api/conversations/${t}/start`,e?{providers_set:e}:{});return s}static async stopConversation(t){const{data:e}=await r.post(`/api/conversations/${t}/stop`);return e}static async getSettings(){const{data:t}=await r.get("/api/settings");return t}static async saveSettings(t){return(await r.post("/api/settings",t)).status===200}static async createCheckoutSession(t){const{data:e}=await r.post("/api/billing/create-checkout-session",{amount:t});return e.redirect_url}static async createBillingSessionResponse(){const{data:t}=await r.post("/api/billing/create-customer-setup-session");return t.redirect_url}static async getBalance(){const{data:t}=await r.get("/api/billing/credits");return t.credits}static async getGitUser(){const t=await r.get("/api/user/info"),{data:e}=t;return{id:e.id,login:e.login,avatar_url:e.avatar_url,company:e.company,name:e.name,email:e.email}}static async searchGitRepositories(t,e=5,s){return(await r.get("/api/user/search/repositories",{params:{query:t,per_page:e,selected_provider:s}})).data}static async getTrajectory(t){const e=`${this.getConversationUrl(t)}/trajectory`,{data:s}=await r.get(e,{headers:this.getConversationHeaders()});return s}static async logout(t){const e=t==="saas"?"/api/logout":"/api/unset-provider-tokens";await r.post(e)}static async getGitChanges(t){const e=`${this.getConversationUrl(t)}/git/changes`,{data:s}=await r.get(e,{headers:this.getConversationHeaders()});return s}static async getGitChangeDiff(t,e){const s=`${this.getConversationUrl(t)}/git/diff`,{data:i}=await r.get(s,{params:{path:e},headers:this.getConversationHeaders()});return i}static async retrieveUserGitRepositories(t,e=1,s=30){const{data:i}=await r.get("/api/user/repositories",{params:{selected_provider:t,sort:"pushed",page:e,per_page:s}}),c=i.length>0&&i[0].link_header?i[0].link_header:"",o=p(c);return{data:i,nextPage:o}}static async retrieveInstallationRepositories(t,e,s,i=1,c=30){const o=s[e],n=await r.get("/api/user/repositories",{params:{selected_provider:t,sort:"pushed",page:i,per_page:c,installation_id:o}}),u=n.data.length>0&&n.data[0].link_header?n.data[0].link_header:"",h=p(u);let d;return h?d=e:e+1<s.length?d=e+1:d=null,{data:n.data,nextPage:h,installationIndex:d}}static async getRepositoryBranches(t){const{data:e}=await r.get(`/api/user/repository/branches?repository=${encodeURIComponent(t)}`);return e}static async getMicroagents(t){const e=`${this.getConversationUrl(t)}/microagents`,{data:s}=await r.get(e,{headers:this.getConversationHeaders()});return s}static async getRepositoryMicroagents(t,e){const{data:s}=await r.get(`/api/user/repository/${t}/${e}/microagents`);return s}static async getRepositoryMicroagentContent(t,e,s){const{data:i}=await r.get(`/api/user/repository/${t}/${e}/microagents/content`,{params:{file_path:s}});return i}static async getMicroagentPrompt(t,e){const s=`${this.getConversationUrl(t)}/remember-prompt`,{data:i}=await r.get(s,{params:{event_id:e},headers:this.getConversationHeaders()});return i.prompt}static async updateConversation(t,e){const{data:s}=await r.patch(`/api/conversations/${t}`,e);return s}static async getFiles(t,e){const s=`${this.getConversationUrl(t)}/list-files`,{data:i}=await r.get(s,{params:{path:e},headers:this.getConversationHeaders()});return i}static async getFile(t,e){const s=`${this.getConversationUrl(t)}/select-file`,{data:i}=await r.get(s,{params:{file:e},headers:this.getConversationHeaders()});return i.code}static async uploadFiles(t,e){const s=new FormData;for(const o of e)s.append("files",o);const i=`${this.getConversationUrl(t)}/upload-files`;return(await r.post(i,s,{headers:{"Content-Type":"multipart/form-data",...this.getConversationHeaders()}})).data}static async getUserInstallationIds(t){const{data:e}=await r.get(`/api/user/installations?provider=${t}`);return e}}export{D as O,A as Q,$ as f};
