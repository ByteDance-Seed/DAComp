import{R as h,r as d,j as e,d as R,i as ge,u as Ce,b as G,N as Ne,G as Se,w as ve,O as Ie,H as _e,l as Ae}from"./chunk-ZYFC6VSF-CV8XXl5-.js";import{I as r}from"./declaration-9L2dPh1x.js";import"./index-CkOlzMPM.js";import{a as D,D as Te,u as Q}from"./use-settings-BH-CDrc3.js";import{u as w,a as we}from"./use-config-CFnQGZ56.js";import{u as Le}from"./useQuery-BM2-aT6w.js";import{_ as ae}from"./module-DMohvay-.js";import{O as M}from"./open-hands-DIyP2mgJ.js";import{u as Oe}from"./use-user-providers-f_AHW4az.js";import{L as $}from"./loading-spinner-kOCOW5GM.js";import{c as k}from"./utils-ortCDxR2.js";import{u as p}from"./useTranslation-mdJfIcDH.js";import{T as L,u as Me}from"./tooltip-button-CiNMEZws.js";import{c as je,u as re,C as be,a as ye,b as Re,d as De}from"./conversation-card-DYV3RUnf.js";import{S as B}from"./all-hands-logo-D0ZNxhno.js";import{S as Pe}from"./plus-C_FZCxTO.js";import{S as Ue}from"./settings-BZ__ebQd.js";import{F as $e}from"./index-CA16_LBd.js";import{M as ke,o as Ge,H as Be,u as Fe}from"./help-link-DzWkpzGm.js";import{M as I}from"./modal-backdrop-eyYAchCQ.js";import{b as He,B as F,a as z,M as X}from"./base-modal-Cy52Bh8C.js";import{e as Ve}from"./settings-utils-C--CGkWg.js";import{B as S,u as H}from"./brand-button-BJrVXPiX.js";import{K as Ke}from"./key-status-icon-DDppEOEs.js";import{S as Ye}from"./settings-input-CY6LSh0u.js";import{u as Z}from"./use-save-settings-CMoK69WE.js";import{u as q}from"./open-hands-axios-BeOZUmy8.js";import{M as O}from"./modal-body-VF1Y6uTQ.js";import{d as ie,a as le}from"./custom-toast-handlers-BD_JVnrP.js";import{R as We}from"./index-DnvoE-Td.js";import{u as Qe,g as ze,L as y,s as Ze,a as ee}from"./use-logout-BouZ0jAe.js";import{h as ce}from"./handle-capture-consent-vowaI1ey.js";import{u as qe}from"./use-balance-Aq7p3vqM.js";import{T as Je}from"./Trans-CWB6yLRR.js";import{e as Xe}from"./index-JbHoVJgB.js";import{S as et}from"./close-BpHH2213.js";import{i as tt}from"./i18next-Bvlggjj8.js";import"./preload-helper-BXl3LOEh.js";import"./i18nInstance-DBIXdvxg.js";import"./infiniteQueryBehavior-C_zInWNc.js";import"./chunk-BOOVDPB6-CfJM8ukF.js";import"./index-B3bthoHG.js";import"./react-redux-9hwipSEO.js";import"./use-conversation-id-Bw4dVlXX.js";import"./agent-state-CFaY3go2.js";import"./chunk-S6H5EOGR-Dp_maNhv.js";import"./vscode-url-helper-5Tt6LlE2.js";import"./ws-client-provider-DFTATbLa.js";import"./store-Bya9Reqe.js";import"./browser-slice-DabBaamq.js";import"./query-client-config-CjL2TgDM.js";import"./retrieve-axios-error-message-CYr77e_f.js";import"./mutation-BAofwZhx.js";import"./use-active-conversation-CH6llXf1.js";import"./use-optimistic-user-message-DCSVn0do.js";import"./iconBase-C5ZFHboU.js";import"./map-provider-g8SgAMsv.js";import"./optional-tag-CertvSQ3.js";import"./index-DuWOChOE.js";const st=(t,s,n)=>{const a=`${s.hostname==="localhost"?s.protocol:"https:"}//${s.host}/oauth/keycloak/callback`;let i;n?i=`https://${n.replace(/^https?:\/\//,"")}`:(i=s.hostname.replace(/(^|\.)staging\.all-hands\.dev$/,"$1auth.staging.all-hands.dev").replace(/(^|\.)app\.all-hands\.dev$/,"auth.app.all-hands.dev").replace(/(^|\.)localhost$/,"auth.staging.all-hands.dev"),i===s.hostname&&s.hostname!=="localhost"&&(i=`auth.${s.hostname}`),i=`https://${i}`);const l="openid email profile",u=s.search?"&":"?",m=`${s.href.replace(/\/$/,"")}${u}login_method=${t}`;return`${i}/realms/allhands/protocol/openid-connect/auth?client_id=allhands&kc_idp_hint=${t}&response_type=code&redirect_uri=${encodeURIComponent(a)}&scope=${encodeURIComponent(l)}&state=${encodeURIComponent(m)}`},A=t=>t.appMode==="saas"?st(t.identityProvider,new URL(window.location.href),t.authUrl):null,nt=t=>A({appMode:t.appMode,identityProvider:"github",authUrl:t.authUrl}),de=()=>{const{data:t}=w(),{data:s}=D(),{providers:n}=Oe();return h.useMemo(()=>!t?.APP_MODE||!s?!1:t.APP_MODE==="oss"?n.length>0:!0,[t?.APP_MODE,s,n.length])},ot=()=>{const{data:t}=w(),s=de(),n=Le({queryKey:["user"],queryFn:M.getGitUser,enabled:s,retry:!1,staleTime:1e3*60*5,gcTime:1e3*60*15});return h.useEffect(()=>{n.data&&ae.identify(n.data.login,{company:n.data.company,name:n.data.name,email:n.data.email,user:n.data.login,mode:t?.APP_MODE||"oss"})},[n.data]),n},at=t=>d.createElement("svg",{width:27,height:26,viewBox:"0 0 27 26",fill:"none",xmlns:"http://www.w3.org/2000/svg",...t},d.createElement("g",{clipPath:"url(#clip0_40000158_426)"},d.createElement("path",{d:"M13.5381 1.83496C7.32618 1.83496 2.29074 6.8704 2.29074 13.0823C2.29074 19.2942 7.32618 24.3297 13.5381 24.3297C19.75 24.3297 24.7855 19.2942 24.7855 13.0823C24.7855 6.8704 19.75 1.83496 13.5381 1.83496Z",stroke:"currentColor",strokeWidth:1.8,strokeLinecap:"round",strokeLinejoin:"round"}),d.createElement("path",{d:"M4.84641 20.22C4.84641 20.22 7.35344 17.019 13.5395 17.019C19.7255 17.019 22.2337 20.22 22.2337 20.22M13.5395 13.0824C14.4344 13.0824 15.2926 12.7269 15.9254 12.0941C16.5582 11.4613 16.9137 10.6031 16.9137 9.70819C16.9137 8.8133 16.5582 7.95505 15.9254 7.32227C15.2926 6.68948 14.4344 6.33398 13.5395 6.33398C12.6446 6.33398 11.7863 6.68948 11.1536 7.32227C10.5208 7.95505 10.1653 8.8133 10.1653 9.70819C10.1653 10.6031 10.5208 11.4613 11.1536 12.0941C11.7863 12.7269 12.6446 13.0824 13.5395 13.0824Z",stroke:"currentColor",strokeWidth:1.8,strokeLinecap:"round",strokeLinejoin:"round"})),d.createElement("defs",null,d.createElement("clipPath",{id:"clip0_40000158_426"},d.createElement("rect",{width:26,height:26,fill:"white",transform:"translate(0.5)"}))));function rt({src:t}){const{t:s}=p();return e.jsx("img",{src:t,alt:s(r.AVATAR$ALT_TEXT),className:"w-full h-full rounded-full"})}function it({onClick:t,avatarUrl:s,isLoading:n}){const{t:o}=p();return e.jsxs(L,{testId:"user-avatar",tooltip:o(r.USER$ACCOUNT_SETTINGS),ariaLabel:o(r.USER$ACCOUNT_SETTINGS),onClick:t,className:k("w-8 h-8 rounded-full flex items-center justify-center cursor-pointer",n&&"bg-transparent"),children:[!n&&s&&e.jsx(rt,{src:s}),!n&&!s&&e.jsx(at,{"aria-label":o(r.USER$AVATAR_PLACEHOLDER),width:28,height:28,className:"text-[#9099AC]"}),n&&e.jsx($,{size:"small"})]})}/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lt=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],ct=je("lock",lt);function dt({onLogout:t,onClose:s}){const n=re(s),{t:o}=p();return e.jsx(be,{testId:"account-settings-context-menu",ref:n,className:"absolute right-full md:left-full -top-1 z-10 w-fit",children:e.jsx(ye,{onClick:t,"data-testid":"logout-button",children:e.jsx(Re,{icon:ct,text:o(r.ACCOUNT_SETTINGS$LOGOUT)})})})}function ut({onLogout:t,user:s,isLoading:n}){const[o,a]=h.useState(!1),i=de(),l=()=>{a(x=>!x)},u=()=>{a(!1)},c=()=>{t(),u()},m=o&&i;return e.jsxs("div",{"data-testid":"user-actions",className:"w-8 h-8 relative cursor-pointer",children:[e.jsx(it,{avatarUrl:s?.avatar_url,onClick:l,isLoading:n}),m&&e.jsx(dt,{onLogout:c,onClose:u})]})}function mt(){const{t}=p();return e.jsx(L,{tooltip:t(r.BRANDING$ALL_HANDS_AI),ariaLabel:t(r.BRANDING$ALL_HANDS_LOGO),navLinkTo:"/",children:e.jsx(B,{width:34,height:34})})}const ft=t=>d.createElement("svg",{width:27,height:27,viewBox:"0 0 27 27",fill:"none",xmlns:"http://www.w3.org/2000/svg",...t},d.createElement("path",{d:"M24.5719 9.17199V14.8456M15.7404 3.4984C14.9543 3.12524 14.095 2.93164 13.2248 2.93164C12.3546 2.93164 11.4952 3.12524 10.7091 3.4984L3.11671 7.05801C1.46456 7.83189 1.46456 10.5121 3.11671 11.286L10.708 14.8456C11.4943 15.2189 12.3538 15.4126 13.2242 15.4126C14.0946 15.4126 14.9541 15.2189 15.7404 14.8456L23.3328 11.286C24.985 10.5121 24.985 7.83189 23.3328 7.05801L15.7404 3.4984Z",stroke:"currentColor",strokeWidth:1.8,strokeLinecap:"round",strokeLinejoin:"round"}),d.createElement("path",{d:"M5.28183 12.5762V18.3916C5.28183 21.7027 10.6082 23.356 13.2249 23.356C15.8415 23.356 21.1679 21.7027 21.1679 18.3916V12.5762",stroke:"currentColor",strokeWidth:1.8,strokeLinecap:"round",strokeLinejoin:"round"}));function ht({disabled:t=!1}){const{t:s}=p();return e.jsx(L,{tooltip:s(r.SIDEBAR$DOCS),ariaLabel:s(r.SIDEBAR$DOCS),href:"https://docs.all-hands.dev",disabled:t,children:e.jsx(ft,{width:28,height:28,className:`text-[#9099AC] ${t?"opacity-50":""}`})})}function pt({disabled:t=!1}){const{t:s}=p(),n=s(r.CONVERSATION$START_NEW);return e.jsx(L,{tooltip:n,ariaLabel:n,navLinkTo:"/",testId:"new-project-button",disabled:t,children:e.jsx(Pe,{width:28,height:28})})}function xt({onClick:t,disabled:s=!1}){const{t:n}=p(),{data:o}=w(),a=o?.APP_MODE==="saas"?"/settings/user":"/settings";return e.jsx(L,{testId:"settings-button",tooltip:n(r.SETTINGS$TITLE),ariaLabel:n(r.SETTINGS$TITLE),onClick:t,navLinkTo:a,disabled:s,children:e.jsx(Ue,{width:28,height:28})})}function Et({isOpen:t,onClick:s,disabled:n=!1}){const{t:o}=p();return e.jsx(L,{testId:"toggle-conversation-panel",tooltip:o(r.SIDEBAR$CONVERSATIONS),ariaLabel:o(r.SIDEBAR$CONVERSATIONS),onClick:s,disabled:n,children:e.jsx($e,{size:22,className:k("cursor-pointer",t?"text-white":"text-[#9099AC]",n&&"opacity-50")})})}function gt({testId:t,title:s,description:n,buttons:o}){return e.jsx(He,{testId:t,title:s,description:n,buttons:[{text:o.danger.text,onClick:o.danger.onClick,className:"bg-danger"},{text:o.cancel.text,onClick:o.cancel.onClick,className:"bg-neutral-500"}]})}function Ct({settings:t,models:s,onClose:n}){const{mutate:o}=Z(),a=R(),{t:i}=p(),l=h.useRef(null),[u,c]=h.useState(!1),m=async C=>{const g=Ve(C);await o(g,{onSuccess:()=>{n(),ae.capture("settings_saved",{LLM_MODEL:g.LLM_MODEL,LLM_API_KEY_SET:g.LLM_API_KEY_SET?"SET":"UNSET",SEARCH_API_KEY_SET:g.SEARCH_API_KEY?"SET":"UNSET",REMOTE_RUNTIME_RESOURCE_FACTOR:g.REMOTE_RUNTIME_RESOURCE_FACTOR})}})},x=()=>{const C=new FormData(l.current??void 0);m(C)},E=C=>{C.preventDefault();const g=new FormData(C.currentTarget);a.pathname.startsWith("/conversations/")?c(!0):m(g)},N=t.LLM_API_KEY_SET;return e.jsxs("div",{children:[e.jsxs("form",{ref:l,"data-testid":"settings-form",className:"flex flex-col gap-6",onSubmit:E,children:[e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx(ke,{models:Ge(s),currentModel:t.LLM_MODEL}),e.jsx(Ye,{testId:"llm-api-key-input",name:"llm-api-key-input",label:i(r.SETTINGS_FORM$API_KEY),type:"password",className:"w-full",placeholder:N?"<hidden>":"",startContent:N&&e.jsx(Ke,{isSet:N})}),e.jsx(Be,{testId:"llm-api-key-help-anchor",text:i(r.SETTINGS$DONT_KNOW_API_KEY),linkText:i(r.SETTINGS$CLICK_FOR_INSTRUCTIONS),href:"https://docs.all-hands.dev/usage/local-setup#getting-an-api-key"})]}),e.jsx("div",{className:"flex flex-col gap-2",children:e.jsx(S,{testId:"save-settings-button",type:"submit",variant:"primary",className:"w-full",children:i(r.BUTTON$SAVE)})})]}),u&&e.jsx(I,{children:e.jsx(gt,{title:i(r.MODAL$END_SESSION_TITLE),description:i(r.MODAL$END_SESSION_MESSAGE),buttons:{danger:{text:i(r.BUTTON$END_SESSION),onClick:x},cancel:{text:i(r.BUTTON$CANCEL),onClick:()=>c(!1)}}})})]})}function Nt({onClose:t,settings:s}){const n=Fe(),{t:o}=p();return e.jsx(I,{children:e.jsxs("div",{"data-testid":"ai-config-modal",className:"bg-base-secondary min-w-[384px] m-4 p-6 rounded-xl flex flex-col gap-2 border border-tertiary",children:[n.error&&e.jsx("p",{className:"text-danger text-xs",children:n.error.message}),e.jsx("span",{className:"text-xl leading-6 font-semibold -tracking-[0.01em]",children:o(r.AI_SETTINGS$TITLE)}),e.jsxs("p",{className:"text-xs text-[#A3A3A3]",children:[o(r.SETTINGS$DESCRIPTION)," ",o(r.SETTINGS$FOR_OTHER_OPTIONS),e.jsx(ge,{"data-testid":"advanced-settings-link",to:"/settings",className:"underline underline-offset-2 text-white",children:o(r.SETTINGS$SEE_ADVANCED_SETTINGS)})]}),n.isLoading&&e.jsx("div",{className:"flex justify-center",children:e.jsx($,{size:"small"})}),n.data&&e.jsx(Ct,{settings:s||Te,models:n.data?.models,onClose:t})]})})}const St=(t=20)=>{const{data:s}=D();return Me({queryKey:["user","conversations","paginated",t],queryFn:({pageParam:n})=>M.getUserConversations(t,n),enabled:!!s,getNextPageParam:n=>n.next_page_id,initialPageParam:void 0})},vt=({hasNextPage:t,isFetchingNextPage:s,fetchNextPage:n,threshold:o=100})=>{const a=d.useRef(null),i=d.useCallback(()=>{if(!a.current||s||!t)return;const{scrollTop:l,scrollHeight:u,clientHeight:c}=a.current;l+c>=u-o&&n()},[t,s,n,o]);return d.useEffect(()=>{const l=a.current;if(l)return l.addEventListener("scroll",i),()=>{l.removeEventListener("scroll",i)}},[i]),a},It=()=>{const t=q();return H({mutationFn:s=>M.deleteUserConversation(s.conversationId),onMutate:async s=>{await t.cancelQueries({queryKey:["user","conversations"]});const n=t.getQueryData(["user","conversations"]);return t.setQueryData(["user","conversations"],o=>o?.filter(a=>a.conversation_id!==s.conversationId)),{previousConversations:n}},onError:(s,n,o)=>{o?.previousConversations&&t.setQueryData(["user","conversations"],o.previousConversations)},onSettled:()=>{t.invalidateQueries({queryKey:["user","conversations"]})}})},_t=()=>{const t=q();return H({mutationFn:s=>M.stopConversation(s.conversationId),onMutate:async()=>(await t.cancelQueries({queryKey:["user","conversations"]}),{previousConversations:t.getQueryData(["user","conversations"])}),onError:(s,n,o)=>{o?.previousConversations&&t.setQueryData(["user","conversations"],o.previousConversations)},onSettled:()=>{t.invalidateQueries({queryKey:["user","conversations"]})}})};function At({onConfirm:t,onCancel:s}){const{t:n}=p();return e.jsx(I,{children:e.jsxs(O,{className:"items-start border border-tertiary",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(F,{title:n(r.CONVERSATION$CONFIRM_DELETE)}),e.jsx(z,{description:n(r.CONVERSATION$DELETE_WARNING)})]}),e.jsxs("div",{className:"flex flex-col gap-2 w-full",onClick:o=>o.stopPropagation(),children:[e.jsx(S,{type:"button",variant:"primary",onClick:t,className:"w-full","data-testid":"confirm-button",children:n(r.ACTION$CONFIRM)}),e.jsx(S,{type:"button",variant:"secondary",onClick:s,className:"w-full","data-testid":"cancel-button",children:n(r.BUTTON$CANCEL)})]})]})})}function Tt({onConfirm:t,onCancel:s}){const{t:n}=p();return e.jsx(I,{children:e.jsxs(O,{className:"items-start border border-tertiary",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(F,{title:n(r.CONVERSATION$CONFIRM_STOP)}),e.jsx(z,{description:n(r.CONVERSATION$STOP_WARNING)})]}),e.jsxs("div",{className:"flex flex-col gap-2 w-full",onClick:o=>o.stopPropagation(),children:[e.jsx(S,{type:"button",variant:"primary",onClick:t,className:"w-full","data-testid":"confirm-button",children:n(r.ACTION$CONFIRM)}),e.jsx(S,{type:"button",variant:"secondary",onClick:s,className:"w-full","data-testid":"cancel-button",children:n(r.BUTTON$CANCEL)})]})]})})}function wt({onConfirm:t,onClose:s}){const{t:n}=p();return e.jsx(I,{children:e.jsxs(O,{testID:"confirm-new-conversation-modal",children:[e.jsx(F,{title:n(r.CONVERSATION$EXIT_WARNING)}),e.jsxs("div",{className:"flex w-full gap-2",children:[e.jsx(X,{text:n(r.ACTION$CONFIRM),onClick:t,className:"bg-[#C63143] flex-1"}),e.jsx(X,{text:n(r.BUTTON$CANCEL),onClick:s,className:"bg-tertiary flex-1"})]})]})})}const Lt=()=>{const t=q();return H({mutationFn:s=>M.updateConversation(s.conversationId,{title:s.newTitle}),onMutate:async s=>{await t.cancelQueries({queryKey:["user","conversations"]});const n=t.getQueryData(["user","conversations"]);return t.setQueryData(["user","conversations"],o=>o?.map(a=>a.conversation_id===s.conversationId?{...a,title:s.newTitle}:a)),{previousConversations:n}},onError:(s,n,o)=>{o?.previousConversations&&t.setQueryData(["user","conversations"],o.previousConversations)},onSettled:(s,n,o)=>{t.invalidateQueries({queryKey:["user","conversations"]}),t.invalidateQueries({queryKey:["user","conversation",o.conversationId]})}})};function Ot({onClose:t}){const{t:s}=p(),{conversationId:n}=Ce(),o=re(t),a=G(),[i,l]=h.useState(!1),[u,c]=h.useState(!1),[m,x]=h.useState(!1),[E,N]=h.useState(null),[C,g]=h.useState(null),{data:T,isFetching:v,error:j,hasNextPage:b,isFetchingNextPage:P,fetchNextPage:V}=St(),_=T?.pages.flatMap(f=>f.results)??[],{mutate:U}=It(),{mutate:K}=_t(),{mutate:me}=Lt(),J=vt({hasNextPage:!!b,isFetchingNextPage:P,fetchNextPage:V,threshold:200}),fe=f=>{l(!0),N(f)},he=f=>{c(!0),N(f)},pe=async(f,Y)=>{me({conversationId:f,newTitle:Y},{onSuccess:()=>{ie(s(r.CONVERSATION$TITLE_UPDATED))}})},xe=()=>{E&&U({conversationId:E},{onSuccess:()=>{E===n&&a("/")}})},Ee=()=>{E&&K({conversationId:E},{onSuccess:()=>{E===n&&a("/")}})};return e.jsxs("div",{ref:f=>{o.current!==f&&(o.current=f),J.current!==f&&(J.current=f)},"data-testid":"conversation-panel",className:"w-[350px] h-full border border-neutral-700 bg-base-secondary rounded-xl overflow-y-auto absolute",children:[v&&_.length===0&&e.jsx("div",{className:"w-full h-full absolute flex justify-center items-center",children:e.jsx($,{size:"small"})}),j&&e.jsx("div",{className:"flex flex-col items-center justify-center h-full",children:e.jsx("p",{className:"text-danger",children:j.message})}),_?.length===0&&e.jsx("div",{className:"flex flex-col items-center justify-center h-full",children:e.jsx("p",{className:"text-neutral-400",children:s(r.CONVERSATION$NO_CONVERSATIONS)})}),_?.map(f=>e.jsx(Ne,{to:`/conversations/${f.conversation_id}`,onClick:t,children:({isActive:Y})=>e.jsx(De,{isActive:Y,onDelete:()=>fe(f.conversation_id),onStop:()=>he(f.conversation_id),onChangeTitle:W=>pe(f.conversation_id,W),title:f.title,selectedRepository:{selected_repository:f.selected_repository,selected_branch:f.selected_branch,git_provider:f.git_provider},lastUpdatedAt:f.last_updated_at,createdAt:f.created_at,conversationStatus:f.status,conversationId:f.conversation_id,contextMenuOpen:C===f.conversation_id,onContextMenuToggle:W=>g(W?f.conversation_id:null)})},f.conversation_id)),P&&e.jsx("div",{className:"flex justify-center py-4",children:e.jsx($,{size:"small"})}),i&&e.jsx(At,{onConfirm:()=>{xe(),l(!1)},onCancel:()=>l(!1)}),u&&e.jsx(Tt,{onConfirm:()=>{Ee(),c(!1)},onCancel:()=>c(!1)}),m&&e.jsx(wt,{onConfirm:()=>{t()},onClose:()=>x(!1)})]})}function Mt({isOpen:t,children:s}){if(!t)return null;const n=document.getElementById("root-outlet");return n?We.createPortal(e.jsx("div",{className:"absolute h-full w-full left-0 top-0 z-20 bg-black/80 rounded-xl",children:s}),n):null}const jt=t=>d.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:24,height:21,viewBox:"0 0 24 21",fill:"none",...t},d.createElement("path",{d:"M3 1.5C2.17157 1.5 1.5 2.17157 1.5 3V15C1.5 15.8284 2.17157 16.5 3 16.5H11.25C11.6642 16.5 12 16.8358 12 17.25C12 17.6642 11.6642 18 11.25 18H3C1.34315 18 0 16.6569 0 15V3C0 1.34315 1.34315 0 3 0H19.5C21.1569 0 22.5 1.34315 22.5 3V9C22.5 9.41421 22.1642 9.75 21.75 9.75C21.3358 9.75 21 9.41421 21 9V3C21 2.17157 20.3284 1.5 19.5 1.5H3Z",fill:"currentColor"}),d.createElement("path",{d:"M4.71967 4.71967C5.01256 4.42678 5.48744 4.42678 5.78033 4.71967L7.76517 6.7045C8.2045 7.14384 8.2045 7.85616 7.76517 8.2955L5.78033 10.2803C5.48744 10.5732 5.01256 10.5732 4.71967 10.2803C4.42678 9.98744 4.42678 9.51256 4.71967 9.21967L6.43934 7.5L4.71967 5.78033C4.42678 5.48744 4.42678 5.01256 4.71967 4.71967Z",fill:"currentColor"}),d.createElement("path",{d:"M8.25 10.5C8.25 10.0858 8.58579 9.75 9 9.75H12C12.4142 9.75 12.75 10.0858 12.75 10.5C12.75 10.9142 12.4142 11.25 12 11.25H9C8.58579 11.25 8.25 10.9142 8.25 10.5Z",fill:"currentColor"}),d.createElement("path",{d:"M24 15.75C24 18.6495 21.6495 21 18.75 21C15.8505 21 13.5 18.6495 13.5 15.75C13.5 12.8505 15.8505 10.5 18.75 10.5C21.6495 10.5 24 12.8505 24 15.75ZM18.75 12.75C18.3358 12.75 18 13.0858 18 13.5V15H16.5C16.0858 15 15.75 15.3358 15.75 15.75C15.75 16.1642 16.0858 16.5 16.5 16.5H18V18C18 18.4142 18.3358 18.75 18.75 18.75C19.1642 18.75 19.5 18.4142 19.5 18V16.5H21C21.4142 16.5 21.75 16.1642 21.75 15.75C21.75 15.3358 21.4142 15 21 15H19.5V13.5C19.5 13.0858 19.1642 12.75 18.75 12.75Z",fill:"currentColor"}));function bt({disabled:t=!1}){const{t:s}=p(),n=s(r.MICROAGENT_MANAGEMENT$TITLE);return e.jsx(L,{tooltip:n,ariaLabel:n,navLinkTo:"/microagent-management",testId:"microagent-management-button",disabled:t,children:e.jsx(jt,{})})}function yt(){const t=R(),s=ot(),{data:n}=w(),{data:o,error:a,isError:i,isFetching:l}=Q(),{mutate:u}=Qe(),[c,m]=h.useState(!1),[x,E]=h.useState(!1),N=n?.FEATURE_FLAGS.HIDE_LLM_SETTINGS&&n?.APP_MODE==="saas",C=n?.FEATURE_FLAGS.HIDE_MICROAGENT_MANAGEMENT;return h.useEffect(()=>{N||(t.pathname==="/settings"?m(!1):!l&&i&&a?.status!==404?le("Something went wrong while fetching settings. Please reload the page."):n?.APP_MODE==="oss"&&a?.status===404&&m(!0))},[a?.status,a,l,t.pathname]),e.jsxs(e.Fragment,{children:[e.jsxs("aside",{className:"h-[40px] md:h-auto px-1 flex flex-row md:flex-col gap-1",children:[e.jsxs("nav",{className:"flex flex-row md:flex-col items-center justify-between w-full h-auto md:w-auto md:h-full",children:[e.jsxs("div",{className:"flex flex-row md:flex-col items-center gap-[26px]",children:[e.jsx("div",{className:"flex items-center justify-center",children:e.jsx(mt,{})}),e.jsx(pt,{disabled:o?.EMAIL_VERIFIED===!1}),e.jsx(Et,{isOpen:x,onClick:()=>o?.EMAIL_VERIFIED===!1?null:E(g=>!g),disabled:o?.EMAIL_VERIFIED===!1}),!C&&e.jsx(bt,{disabled:o?.EMAIL_VERIFIED===!1})]}),e.jsxs("div",{className:"flex flex-row md:flex-col md:items-center gap-[26px] md:mb-4",children:[e.jsx(ht,{disabled:o?.EMAIL_VERIFIED===!1}),e.jsx(xt,{disabled:o?.EMAIL_VERIFIED===!1}),e.jsx(ut,{user:s.data?{avatar_url:s.data.avatar_url}:void 0,onLogout:u,isLoading:s.isFetching})]})]}),x&&e.jsx(Mt,{isOpen:x,children:e.jsx(Ot,{onClose:()=>E(!1)})})]}),c&&e.jsx(Nt,{settings:o,onClose:()=>m(!1)})]})}const Rt=t=>d.createElement("svg",{width:22,height:22,viewBox:"0 0 22 22",fill:"none",xmlns:"http://www.w3.org/2000/svg",...t},d.createElement("path",{d:"M12 2.25C6.624 2.25 2.25 6.624 2.25 12C2.25 16.376 5.115 20.073 9.057 21.428C9.563 21.514 9.747 21.211 9.747 20.95C9.747 20.713 9.738 19.991 9.738 19.153C7 19.713 6.4 18.45 6.4 18.45C5.952 17.387 5.328 17.084 5.328 17.084C4.476 16.487 5.387 16.487 5.387 16.487C6.328 16.546 6.85 17.481 6.85 17.481C7.675 18.862 9.057 18.487 9.776 18.226C9.867 17.603 10.133 17.179 10.419 16.94C8.287 16.713 6.05 15.85 6.05 11.9C6.05 10.837 6.4 9.975 6.859 9.3C6.759 9.05 6.45 8.038 6.95 6.65C6.95 6.65 7.734 6.4 9.738 7.775C10.483 7.534 11.25 7.413 12.017 7.413C12.784 7.413 13.55 7.534 14.296 7.775C16.3 6.4 17.084 6.65 17.084 6.65C17.584 8.038 17.275 9.05 17.175 9.3C17.634 9.975 17.984 10.837 17.984 11.9C17.984 15.85 15.747 16.7 13.615 16.94C13.975 17.237 14.296 17.813 14.296 18.7C14.296 19.975 14.287 20.6 14.287 20.95C14.287 21.211 14.471 21.514 14.977 21.428C18.919 20.073 21.784 16.376 21.784 12C21.784 6.624 17.376 2.25 12 2.25Z",fill:"currentColor"})),Dt=t=>d.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"97 99 186 182",...t},d.createElement("defs",null,d.createElement("style",null,".cls-1{fill:currentColor;}")),d.createElement("g",{id:"LOGO"},d.createElement("path",{className:"cls-1",d:"M282.83,170.73l-.27-.69-26.14-68.22a6.81,6.81,0,0,0-2.69-3.24,7,7,0,0,0-8,.43,7,7,0,0,0-2.32,3.52l-17.65,54H154.29l-17.65-54A6.86,6.86,0,0,0,134.32,99a7,7,0,0,0-8-.43,6.87,6.87,0,0,0-2.69,3.24L97.44,170l-.26.69a48.54,48.54,0,0,0,16.1,56.1l.09.07.24.17,39.82,29.82,19.7,14.91,12,9.06a8.07,8.07,0,0,0,9.76,0l12-9.06,19.7-14.91,40.06-30,.1-.08A48.56,48.56,0,0,0,282.83,170.73Z"}))),Pt=t=>d.createElement("svg",{role:"img",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",...t},d.createElement("title",null,"Bitbucket"),d.createElement("path",{d:"M.778 1.213a.768.768 0 00-.768.892l3.263 19.81c.084.5.515.868 1.022.873H19.95a.772.772 0 00.77-.646l3.27-20.03a.768.768 0 00-.768-.891zM14.52 15.53H9.522L8.17 8.466h7.561z"}));function Ut({githubAuthUrl:t,appMode:s,authUrl:n,providersConfigured:o}){const{t:a}=p(),i=A({appMode:s||null,identityProvider:"gitlab",authUrl:n}),l=A({appMode:s||null,identityProvider:"bitbucket",authUrl:n}),u=A({appMode:s||null,identityProvider:"enterprise_sso",authUrl:n}),c=()=>{t&&(window.location.href=t)},m=()=>{i&&(window.location.href=i)},x=()=>{l&&(window.location.href=l)},E=()=>{u&&(window.location.href=u)},N=o&&o.length>0&&o.includes("github"),C=o&&o.length>0&&o.includes("gitlab"),g=o&&o.length>0&&o.includes("bitbucket"),T=o&&o.length>0&&o.includes("enterprise_sso"),v=!o||o.length===0;return e.jsx(I,{children:e.jsxs(O,{className:"border border-tertiary",children:[e.jsx(B,{width:68,height:46}),e.jsx("div",{className:"flex flex-col gap-2 w-full items-center text-center",children:e.jsx("h1",{className:"text-2xl font-bold",children:a(r.AUTH$SIGN_IN_WITH_IDENTITY_PROVIDER)})}),e.jsx("div",{className:"flex flex-col gap-3 w-full",children:v?e.jsx("div",{className:"text-center p-4 text-muted-foreground",children:a(r.AUTH$NO_PROVIDERS_CONFIGURED)}):e.jsxs(e.Fragment,{children:[N&&e.jsx(S,{type:"button",variant:"primary",onClick:c,className:"w-full",startContent:e.jsx(Rt,{width:20,height:20}),children:a(r.GITHUB$CONNECT_TO_GITHUB)}),C&&e.jsx(S,{type:"button",variant:"primary",onClick:m,className:"w-full",startContent:e.jsx(Dt,{width:20,height:20}),children:a(r.GITLAB$CONNECT_TO_GITLAB)}),g&&e.jsx(S,{type:"button",variant:"primary",onClick:x,className:"w-full",startContent:e.jsx(Pt,{width:20,height:20}),children:a(r.BITBUCKET$CONNECT_TO_BITBUCKET)}),T&&e.jsx(S,{type:"button",variant:"primary",onClick:E,className:"w-full",children:a(r.ENTERPRISE_SSO$CONNECT_TO_ENTERPRISE_SSO)})]})}),e.jsxs("p",{className:"mt-4 text-xs text-center text-muted-foreground","data-testid":"auth-modal-terms-of-service",children:[a(r.AUTH$BY_SIGNING_UP_YOU_AGREE_TO_OUR)," ",e.jsx("a",{href:"https://www.all-hands.dev/tos",target:"_blank",className:"underline hover:text-primary",rel:"noopener noreferrer",children:a(r.COMMON$TERMS_OF_SERVICE)})," ",a(r.COMMON$AND)," ",e.jsx("a",{href:"https://www.all-hands.dev/privacy",target:"_blank",className:"underline hover:text-primary",rel:"noopener noreferrer",children:a(r.COMMON$PRIVACY_POLICY)}),"."]})]})})}function $t(){const{t}=p();return e.jsx(I,{children:e.jsxs(O,{className:"border border-tertiary",children:[e.jsx(B,{width:68,height:46}),e.jsx("div",{className:"flex flex-col gap-2 w-full items-center text-center",children:e.jsx("h1",{className:"text-2xl font-bold",children:t(r.AUTH$LOGGING_BACK_IN)})})]})})}function kt({onClose:t}){const{t:s}=p(),{mutate:n}=Z(),o=async a=>{a.preventDefault();const l=new FormData(a.currentTarget).get("analytics")==="on";n({user_consents_to_analytics:l},{onSuccess:()=>{ce(l),t()}})};return e.jsx(I,{children:e.jsx("form",{"data-testid":"user-capture-consent-form",onSubmit:o,className:"flex flex-col gap-2",children:e.jsxs(O,{className:"border border-tertiary",children:[e.jsx(F,{title:s(r.ANALYTICS$TITLE)}),e.jsx(z,{children:s(r.ANALYTICS$DESCRIPTION)}),e.jsxs("label",{className:"flex gap-2 items-center self-start",children:[e.jsx("input",{name:"analytics",type:"checkbox",defaultChecked:!0}),s(r.ANALYTICS$SEND_ANONYMOUS_DATA)]}),e.jsx(S,{testId:"confirm-preferences",type:"submit",variant:"primary",className:"w-full",children:s(r.ANALYTICS$CONFIRM_PREFERENCES)})]})})})}const Gt=()=>{const{mutate:t}=Z();return{migrateUserConsent:h.useCallback(async n=>{const o=localStorage.getItem("analytics-consent");o&&(n?.handleAnalyticsWasPresentInLocalStorage(),await t({user_consents_to_analytics:o==="true"},{onSuccess:()=>{ce(o==="true")}}),localStorage.removeItem("analytics-consent"))},[])}};function Bt(){const{t}=p(),{mutate:s,isPending:n}=H({mutationFn:M.createBillingSessionResponse,onSuccess:o=>{window.location.href=o},onError:()=>{le(t(r.BILLING$ERROR_WHILE_CREATING_SESSION))}});return e.jsx(I,{children:e.jsxs(O,{className:"border border-tertiary",children:[e.jsx(B,{width:68,height:46}),e.jsxs("div",{className:"flex flex-col gap-2 w-full items-center text-center",children:[e.jsx("h1",{className:"text-2xl font-bold",children:t(r.BILLING$YOUVE_GOT_50)}),e.jsx("p",{children:e.jsx(Je,{i18nKey:"BILLING$CLAIM_YOUR_50",components:{b:e.jsx("strong",{})}})})]}),e.jsx(S,{testId:"proceed-to-stripe-button",type:"submit",variant:"primary",className:"w-full",isDisabled:n,onClick:s,children:t(r.BILLING$PROCEED_TO_STRIPE)})]})})}const Ft=()=>{const{data:t,isLoading:s}=w(),{data:n,isLoading:o}=D(),a=ze(),i=A({appMode:t?.APP_MODE||null,identityProvider:"github",authUrl:t?.AUTH_URL}),l=A({appMode:t?.APP_MODE||null,identityProvider:"gitlab",authUrl:t?.AUTH_URL}),u=A({appMode:t?.APP_MODE||null,identityProvider:"bitbucket",authUrl:t?.AUTH_URL}),c=A({appMode:t?.APP_MODE||null,identityProvider:"enterprise_sso",authUrl:t?.AUTH_URL});d.useEffect(()=>{if(t?.APP_MODE!=="saas"||s||o||n||!a)return;let m=null;if(a===y.GITHUB?m=i:a===y.GITLAB?m=l:a===y.BITBUCKET?m=u:a===y.ENTERPRISE_SSO&&(m=c),m){const x=new URL(m);x.searchParams.append("login_method",a),window.location.href=x.toString()}},[t?.APP_MODE,n,s,o,a,i,l,u,c])},Ht=()=>{const t=R(),{data:s,isLoading:n}=D(),{data:o}=w(),a=G();d.useEffect(()=>{if(o?.APP_MODE!=="saas"||n||!s)return;const i=new URLSearchParams(t.search),l=i.get("login_method");if(Object.values(y).includes(l)){Ze(l),i.delete("login_method");const u=`${t.pathname}${i.toString()?`?${i.toString()}`:""}`;a(u,{replace:!0})}},[s,n,t.search,o?.APP_MODE])};function Vt({children:t}){const{data:s,isLoading:n}=Q(),o=G(),{pathname:a}=R();return h.useEffect(()=>{n||s?.EMAIL_VERIFIED===!1&&a!=="/settings/user"&&o("/settings/user",{replace:!0})},[s?.EMAIL_VERIFIED,a,o,n]),t}const te=Symbol.for("constructDateFrom");function Kt(t,s){return typeof t=="function"?t(s):t&&typeof t=="object"&&te in t?t[te](s):t instanceof Date?new t.constructor(s):new Date(s)}function se(t,s){return Kt(t,t)}function Yt(t,s){return+se(t)<+se(s)}function ue(t,s){window.dispatchEvent(new StorageEvent("storage",{key:t,newValue:s}))}const ne=(t,s)=>{const n=JSON.stringify(s);window.localStorage.setItem(t,n),ue(t,n)},Wt=t=>{window.localStorage.removeItem(t),ue(t,null)},oe=t=>window.localStorage.getItem(t),Qt=t=>(window.addEventListener("storage",t),()=>window.removeEventListener("storage",t)),zt=()=>{throw Error("useLocalStorage is a client-only hook")};function Zt(t,s){const n=()=>oe(t),o=d.useSyncExternalStore(Qt,n,zt),a=d.useCallback(i=>{try{const l=typeof i=="function"?i(JSON.parse(o)):i;l==null?Wt(t):ne(t,l)}catch(l){console.warn(l)}},[t,o]);return d.useEffect(()=>{oe(t)===null&&typeof s<"u"&&ne(t,s)},[t,s]),[o?JSON.parse(o):s,a]}function qt({startTime:t}){const{t:s}=p(),[n,o]=Zt("maintenance_banner_dismissed_at",null),i=(u=>{try{let c;if(u.includes("T")&&(u.includes("-05:00")||u.includes("-04:00")||u.includes("EST")||u.includes("EDT")))c=new Date(u);else{const m=new Date(u);if(Number.isNaN(m.getTime()))throw new Error("Invalid date");c=m}return c.toLocaleString(void 0,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",timeZoneName:"short"})}catch(c){return console.warn("Failed to parse maintenance time:",c),u}})(t);return d.useMemo(()=>Number.isNaN(new Date(t).getTime())?!1:n?Yt(new Date(n),new Date(t)):!0,[n,t])?e.jsxs("div",{"data-testid":"maintenance-banner",className:k("bg-primary text-[#0D0F11] p-4 rounded","flex flex-row items-center justify-between"),children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(Xe,{className:"text-white align-middle"})}),e.jsx("div",{className:"ml-3",children:e.jsx("p",{className:"text-sm font-medium",children:s("MAINTENANCE$SCHEDULED_MESSAGE",{time:i})})})]}),e.jsx("button",{type:"button","data-testid":"dismiss-button",onClick:()=>o(i),className:k("bg-[#0D0F11] rounded-full w-5 h-5 flex items-center justify-center cursor-pointer"),children:e.jsx(et,{})})]}):null}const nn=Se(function(){const s=_e(),{t:n}=p();return Ae(s)?e.jsxs("div",{children:[e.jsx("h1",{children:s.status}),e.jsx("p",{children:s.statusText}),e.jsx("pre",{children:s.data instanceof Object?JSON.stringify(s.data):s.data})]}):s instanceof Error?e.jsxs("div",{children:[e.jsx("h1",{children:n(r.ERROR$GENERIC)}),e.jsx("pre",{children:s.message})]}):e.jsx("div",{children:e.jsx("h1",{children:n(r.ERROR$UNKNOWN)})})}),on=ve(function(){const s=G(),{pathname:n}=R(),o=we(),{data:a}=Q(),{error:i}=qe(),{migrateUserConsent:l}=Gt(),{t:u}=p(),c=w(),{data:m,isFetching:x,isError:E}=D(),N=nt({appMode:c.data?.APP_MODE||null,gitHubClientId:c.data?.GITHUB_CLIENT_ID||null,authUrl:c.data?.AUTH_URL}),C=o?null:N,[g,T]=h.useState(!1);Ft(),Ht(),h.useEffect(()=>{!o&&a?.LANGUAGE&&tt.changeLanguage(a.LANGUAGE)},[a?.LANGUAGE,o]),h.useEffect(()=>{if(!o){const _=a?.USER_CONSENTS_TO_ANALYTICS===null;T(_)}},[a,o]),h.useEffect(()=>{o||l({handleAnalyticsWasPresentInLocalStorage:()=>{T(!1)}})},[o]),h.useEffect(()=>{a?.IS_NEW_USER&&c.data?.APP_MODE==="saas"&&ie(u(r.BILLING$YOURE_IN))},[a?.IS_NEW_USER,c.data?.APP_MODE]),h.useEffect(()=>{!o&&i?.status===402&&n!=="/"&&s("/")},[i?.status,n,o]);const v=h.useCallback(()=>typeof window<"u"&&window.localStorage?localStorage.getItem(ee.LOGIN_METHOD)!==null:!1,[]),[j,b]=h.useState(v());h.useEffect(()=>{const _=K=>{K.key===ee.LOGIN_METHOD&&b(v())},U=()=>{b(v())};return window.addEventListener("storage",_),window.addEventListener("focus",U),()=>{window.removeEventListener("storage",_),window.removeEventListener("focus",U)}},[v]),h.useEffect(()=>{b(v())},[m,v]);const P=!m&&!E&&!x&&!o&&c.data?.APP_MODE==="saas"&&!j,V=!m&&!E&&!x&&!o&&c.data?.APP_MODE==="saas"&&j;return e.jsxs("div",{"data-testid":"root-layout",className:"bg-base p-3 h-screen lg:min-w-[1024px] flex flex-col md:flex-row gap-3",children:[e.jsx(yt,{}),e.jsxs("div",{className:"flex flex-col w-full h-[calc(100%-50px)] md:h-full gap-3",children:[c.data?.MAINTENANCE&&e.jsx("div",{className:"flex-shrink-0",children:e.jsx(qt,{startTime:c.data.MAINTENANCE.startTime})}),e.jsx("div",{id:"root-outlet",className:"flex-1 relative overflow-auto",children:e.jsx(Vt,{children:e.jsx(Ie,{})})})]}),P&&e.jsx(Ut,{githubAuthUrl:C,appMode:c.data?.APP_MODE,providersConfigured:c.data?.PROVIDERS_CONFIGURED,authUrl:c.data?.AUTH_URL}),V&&e.jsx($t,{}),c.data?.APP_MODE==="oss"&&g&&e.jsx(kt,{onClose:()=>{T(!1)}}),c.data?.FEATURE_FLAGS.ENABLE_BILLING&&c.data?.APP_MODE==="saas"&&a?.IS_NEW_USER&&e.jsx(Bt,{})]})});export{nn as ErrorBoundary,on as default};
