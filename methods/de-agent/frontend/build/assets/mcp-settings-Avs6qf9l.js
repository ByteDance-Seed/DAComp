import{j as s,r as m,w as u}from"./chunk-ZYFC6VSF-CV8XXl5-.js";import{_}from"./module-DMohvay-.js";import{u as p}from"./use-settings-BH-CDrc3.js";import{u as T}from"./use-save-settings-CMoK69WE.js";import{I as e}from"./declaration-9L2dPh1x.js";import{u as f}from"./useTranslation-mdJfIcDH.js";import{B as N}from"./brand-button-BJrVXPiX.js";import{c as g}from"./utils-ortCDxR2.js";import{T as C}from"./Trans-CWB6yLRR.js";import{a as j,d as I}from"./custom-toast-handlers-BD_JVnrP.js";import{r as v}from"./retrieve-axios-error-message-CYr77e_f.js";import"./useQuery-BM2-aT6w.js";import"./open-hands-axios-BeOZUmy8.js";import"./open-hands-DIyP2mgJ.js";import"./use-config-CFnQGZ56.js";import"./i18nInstance-DBIXdvxg.js";import"./mutation-BAofwZhx.js";import"./index-DuWOChOE.js";function y({servers:a}){const{t:r}=f();return s.jsxs("div",{children:[s.jsxs("h4",{className:"text-sm font-medium mb-2",children:[r(e.SETTINGS$MCP_SSE_SERVERS)," ",s.jsxs("span",{className:"text-gray-500",children:["(",a.length,")"]})]}),a.map((t,n)=>s.jsxs("div",{className:"mb-2 p-2 bg-base-tertiary rounded-md",children:[s.jsxs("div",{className:"text-sm",children:[s.jsxs("span",{className:"font-medium",children:[r(e.SETTINGS$MCP_URL),":"]})," ",typeof t=="string"?t:t.url]}),typeof t!="string"&&t.api_key&&s.jsxs("div",{className:"mt-1 text-sm text-gray-500",children:[s.jsxs("span",{className:"font-medium",children:[r(e.SETTINGS$MCP_API_KEY),":"]})," ",t.api_key?"Configured":r(e.SETTINGS$MCP_API_KEY_NOT_SET)]})]},`sse-${n}`))]})}function R({servers:a}){const{t:r}=f();return s.jsxs("div",{children:[s.jsxs("h4",{className:"text-sm font-medium mb-2",children:[r(e.SETTINGS$MCP_STDIO_SERVERS)," ",s.jsxs("span",{className:"text-gray-500",children:["(",a.length,")"]})]}),a.map((t,n)=>s.jsxs("div",{className:"mb-2 p-2 bg-base-tertiary rounded-md",children:[s.jsxs("div",{className:"text-sm",children:[s.jsxs("span",{className:"font-medium",children:[r(e.SETTINGS$MCP_NAME),":"]})," ",t.name]}),s.jsxs("div",{className:"mt-1 text-sm text-gray-500",children:[s.jsxs("span",{className:"font-medium",children:[r(e.SETTINGS$MCP_COMMAND),":"]})," ",s.jsx("code",{className:"font-mono",children:t.command})]}),t.args&&t.args.length>0&&s.jsxs("div",{className:"mt-1 text-sm text-gray-500",children:[s.jsxs("span",{className:"font-medium",children:[r(e.SETTINGS$MCP_ARGS),":"]})," ",s.jsx("code",{className:"font-mono",children:t.args.join(" ")})]}),t.env&&Object.keys(t.env).length>0&&s.jsxs("div",{className:"mt-1 text-sm text-gray-500",children:[s.jsxs("span",{className:"font-medium",children:[r(e.SETTINGS$MCP_ENV),":"]})," ",s.jsx("code",{className:"font-mono",children:Object.entries(t.env).map(([c,o])=>`${c}=${o}`).join(", ")})]})]},`stdio-${n}`))]})}const P={sse_servers:[],stdio_servers:[]};function M({mcpConfig:a,onChange:r,onCancel:t}){const{t:n}=f(),[c,o]=m.useState(()=>JSON.stringify(a||P,null,2)),[l,x]=m.useState(null),S=m.useRef(null);m.useEffect(()=>{S.current?.focus()},[]);const h=i=>{o(i.target.value)},E=()=>{try{const i=JSON.parse(c);if(!i.sse_servers||!Array.isArray(i.sse_servers))throw new Error(n(e.SETTINGS$MCP_ERROR_SSE_ARRAY));if(!i.stdio_servers||!Array.isArray(i.stdio_servers))throw new Error(n(e.SETTINGS$MCP_ERROR_STDIO_ARRAY));for(const d of i.sse_servers)if(typeof d!="string"&&(!d.url||typeof d.url!="string"))throw new Error(n(e.SETTINGS$MCP_ERROR_SSE_URL));for(const d of i.stdio_servers)if(!d.name||!d.command)throw new Error(n(e.SETTINGS$MCP_ERROR_STDIO_PROPS));r(i),x(null)}catch(i){x(i instanceof Error?i.message:n(e.SETTINGS$MCP_ERROR_INVALID_JSON))}};return s.jsxs("div",{children:[s.jsx("p",{className:"mb-2 text-sm text-gray-400",children:s.jsx(C,{i18nKey:e.SETTINGS$MCP_CONFIG_DESCRIPTION,components:{a:s.jsx("a",{href:"https://docs.all-hands.dev/usage/mcp",target:"_blank",rel:"noopener noreferrer",className:"text-blue-400 hover:underline",children:"documentation"})}})}),s.jsx("textarea",{ref:S,className:g("w-full h-64 resize-y p-2 rounded-sm text-sm font-mono","bg-tertiary border border-[#717888]","placeholder:italic placeholder:text-tertiary-alt","focus:outline-none focus:ring-1 focus:ring-primary","disabled:bg-[#2D2F36] disabled:border-[#2D2F36] disabled:cursor-not-allowed"),value:c,onChange:h,spellCheck:"false"}),l&&s.jsxs("div",{className:"mt-2 p-2 bg-red-100 border border-red-300 rounded-md text-sm text-red-700",children:[s.jsx("strong",{children:n(e.SETTINGS$MCP_CONFIG_ERROR)})," ",l]}),s.jsxs("div",{className:"mt-2 text-sm text-gray-400",children:[s.jsx("strong",{children:n(e.SETTINGS$MCP_CONFIG_EXAMPLE)})," ",s.jsx("code",{children:'{ "sse_servers": ["https://example-mcp-server.com/sse"], "stdio_servers": [{ "name": "fetch", "command": "uvx", "args": ["mcp-server-fetch"] }] }'})]}),s.jsxs("div",{className:"mt-4 flex justify-end gap-3",children:[s.jsx(N,{type:"button",variant:"secondary",onClick:t,children:n(e.BUTTON$CANCEL)}),s.jsx(N,{type:"button",variant:"primary",onClick:E,children:n(e.SETTINGS$MCP_PREVIEW_CHANGES)})]})]})}function G({mcpConfig:a,onChange:r}){const{t}=f(),[n,c]=m.useState(!1),o=x=>{r(x),c(!1)},l=a||{sse_servers:[],stdio_servers:[]};return s.jsxs("div",{children:[s.jsxs("div",{className:"flex flex-col gap-2 mb-6",children:[s.jsx("div",{className:"text-sm font-medium",children:t(e.SETTINGS$MCP_TITLE)}),s.jsx("p",{className:"text-xs text-[#A3A3A3]",children:t(e.SETTINGS$MCP_DESCRIPTION)})]}),!n&&s.jsx("div",{className:"flex justify-between items-center mb-4",children:s.jsx("div",{className:"flex items-center",children:s.jsx(N,{type:"button",variant:"primary",onClick:()=>c(!0),children:t(e.SETTINGS$MCP_EDIT_CONFIGURATION)})})}),s.jsx("div",{children:n?s.jsx(M,{mcpConfig:a,onChange:o,onCancel:()=>c(!1)}):s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"flex flex-col gap-6",children:[s.jsx("div",{children:s.jsx(y,{servers:l.sse_servers})}),s.jsx("div",{children:s.jsx(R,{servers:l.stdio_servers})})]}),l.sse_servers.length===0&&l.stdio_servers.length===0&&s.jsx("div",{className:"mt-4 p-2 bg-yellow-50 border border-yellow-200 rounded-md text-sm text-yellow-700",children:t(e.SETTINGS$MCP_NO_SERVERS_CONFIGURED)})]})})]})}function b(){const{t:a}=f(),{data:r,isLoading:t}=p(),{mutate:n,isPending:c}=T(),[o,l]=m.useState(void 0),[x,S]=m.useState(!1);m.useEffect(()=>{!o&&r?.MCP_CONFIG&&l(r.MCP_CONFIG)},[r,o]);const h=i=>{l(i),S(!0)},E=()=>{r&&n({MCP_CONFIG:o},{onSuccess:()=>{I(a(e.SETTINGS$SAVED)),_.capture("settings_saved",{HAS_MCP_CONFIG:o?"YES":"NO",MCP_SSE_SERVERS_COUNT:o?.sse_servers?.length||0,MCP_STDIO_SERVERS_COUNT:o?.stdio_servers?.length||0}),S(!1)},onError:i=>{const d=v(i);j(d||a(e.ERROR$GENERIC))}})};return t?s.jsx("div",{className:"p-9",children:a(e.HOME$LOADING)}):s.jsxs("form",{"data-testid":"mcp-settings-screen",action:E,className:"flex flex-col h-full justify-between",children:[s.jsx("div",{className:"p-9 flex flex-col gap-12",children:s.jsx(G,{mcpConfig:o,onChange:h})}),s.jsx("div",{className:"flex gap-6 p-6 justify-end border-t border-t-tertiary",children:s.jsxs(N,{testId:"submit-button",type:"submit",variant:"primary",isDisabled:!x||c,children:[!c&&a(e.SETTINGS$SAVE_CHANGES),c&&a(e.SETTINGS$SAVING)]})})]})}const q=u(b);export{q as default};
