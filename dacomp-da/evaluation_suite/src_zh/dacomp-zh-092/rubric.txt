# [总分 | 60分] 客户盈利波动风险评级评分标准
---
## 需求1：高波动客户群体识别与样本验证（本需求最高可得 12分）
### 标准1.1：波动性阈值抽取与账户对齐（最高可得 12分）
#### 路径1.1.A [12分 | SQL/Python 联合抽取]
- 小标准1.1.A.1 [3分 | 完备性]：说明以 `quickbooks__profitability_analysis` 为基础，按 `customer_id` 聚合 `MAX(customer_margin_volatility)`，并列出用于后续计算的字段字典（含 `customer_margin_volatility` → 月度毛利波动系数、`gross_profit` → 单笔毛利、`invoice_total` → 单笔开票额、`transaction_date` → 记账日期、`revenue_year`/`revenue_quarter` → 报表季度标签）。需明确样本基准日 `MAX(transaction_date)=2025-10-14 00:00:00`，分析窗口固定为 [2024-10-15, 2025-10-14]。
- 小标准1.1.A.2 [7分 | 精确性]：验证 `COUNT(DISTINCT customer_id)=2800`，并基于排序第 `ceil(2800×0.75)=2100` 位的波动值确认阈值 `customer_margin_volatility≥0.28717`（允差±0.00001）。输出高波动客户数 `701`（允差±1），且高波组在全量收入与毛利的占比分别为 `30.57%` 和 `30.68%`（允差±0.10pp）。需列示≥5家样例（如 `CUS92807524262` 等）原始标签与解析结果的对照。严禁通过删除或修改原始文本规避校验。
- 小标准1.1.A.3 [2分 | 结论性]：明确多发票客户需先聚合后下游计算，禁止通过去重删除重复行。需记录高波组 ID 清单的生成路径（SQL 片段或脚本函数），以支持后续特征计算复跑。

## 需求2：波动性强度量化与时间窗口统计（本需求最高可得 12分）
### 标准2.1：12 个月毛利变异系数计算（最高可得 6分）
#### 路径2.1.A [6分 | 逐月聚合]
- 小标准2.1.A.1 [1分 | 完备性]：固定滚动窗口为 [2024-10-15, 2025-10-14]，按 `strftime('%Y-%m', transaction_date)` 聚合高波客户月度毛利，并声明 `CV = σ(gross_profit_月)/μ(gross_profit_月)`，对单月样本强制输出 `CV=0`。
- 小标准2.1.A.2 [4分 | 精确性]：复现 `671` 名客户形成月度序列（允差±2），`CV` 样本均值 `0.2275`、中位数 `0.2168`、四分位点 `{Q1=0.0000, Q3=0.3728}`、最大值 `0.8809`（均允差±0.0005）。需列举 ≥2 个典型客户的月度序列与统计，如 `CUS92807524262`：月度毛利 {2025-01=6032.24, 2025-05=201.59, 2025-07=2051.01} → `μ=2761.61`、`σ=2432.81`、`CV=0.88094`；`CUS33191341362`：{2024-12=3674.62, 2025-04=1271.16, 2025-06=787.06} → `CV=0.66075`。
- 小标准2.1.A.3 [1分 | 结论性]：指出月度命中数均值 `2.27`，`CV=0` 主要来源于单月样本（比例需说明），建模时需对零方差进行缺失/拉平处理以避免失真。

### 标准2.2：季度环比增速方差计算（最高可得 6分）
#### 路径2.2.A [6分 | 报表季度口径]
- 小标准2.2.A.1 [1分 | 完备性]：阐明以 `revenue_year`+`revenue_quarter` 为分组键，对同一客户季度开票额求和后计算 `QoQ = (rev_t - rev_{t-1})/rev_{t-1}`，若上一季度金额为 0 则跳过该对。
- 小标准2.2.A.2 [4分 | 精确性]：确认 `491` 名客户存在至少 1 个环比值（允差±2），环比方差均值 `0.08995`、中位数 `0.00000`、上四分位 `0.05286`、最大值 `1.71461`（均允差±0.0005）。示例：`CUS29788258829` 的季度序列 {2023-Q3:15077.52, 2023-Q4:3842.90, 2024-Q3:9673.41, 2025-Q3:4200.67} → 环比 {-0.7451, +1.5172, -0.5658}，方差 `1.05435`；`CUS16315388822` → 方差 `0.54781`。
- 小标准2.2.A.3 [1分 | 结论性]：说明季度标签与交易日期存在跨年度分摊（需保留原账务标签），并提出对缺少 ≥2 个环比点客户的补位策略（如置 0 或标记缺失）。

## 需求3：行为特征与生命周期关联分析（本需求最高可得 12分）
### 标准3.1：RFM & 生命周期暴露率（最高可得 6分）
#### 路径3.1.A [6分 | 分布对比]
- 小标准3.1.A.1 [1分 | 完备性]：说明使用 `quickbooks__customer_analytics`，将高波名单与全量客户按 `customer_id` 精确匹配，统计 `rfm_segment` 与 `lifecycle_stage` 的占比；缺失值统一归类 `UNKNOWN`。
- 小标准3.1.A.2 [4分 | 精确性]：复现关键段位的暴露率：`Champions` 133/480 → 27.71%，`New Customers` 129/485 → 26.60%，`Loyal Customers` 119/491 → 24.24%，`At Risk` 109/448 → 24.33%（每项允差±0.20pp）。生命周期分布需给出 `{New Customer:206/754=27.32%，Loyal Customer:180/692=26.01%，Mature:158/681=23.20%，Growing:157/673=23.33%}`。
- 小标准3.1.A.3 [1分 | 结论性]：指出高波组在高价值段（Champions）与风险段（At Risk）同时抬升，提示需区分“价值驱动”与“风险驱动”的不同运营策略。

### 标准3.2：支付行为与趋势特征（最高可得 6分）
#### 路径3.2.A [6分 | 双指标联动]
- 小标准3.2.A.1 [1分 | 完备性]：构建支付行为（Excellent/Good/Average/Poor）与两类波动指标的拼接表，`CV` 来自月度毛利，`Var_qoq` 来自环比方差；负值 `revenue_trend_correlation` 需追加标记。
- 小标准3.2.A.2 [4分 | 精确性]：验证 `CV` 均值 `{Excellent:0.19608, Good:0.23916, Average:0.24589, Poor:0.22982}` 与 `Var_qoq` 均值 `{Excellent:0.07920, Good:0.11404, Average:0.07068, Poor:0.09584}`（允差±0.001）。需说明高波组中支付行为计数 `{Excellent:178, Good:176, Average:176, Poor:171}`（允差±1）。
- 小标准3.2.A.3 [1分 | 结论性]：强调“支付为 Good 但方差最高”的异常链路，结合 `revenue_trend_correlation` 均值 `0.0043`（VS 全量 `-0.0150`）提示高波客户仍具成长潜力，需在评分中引入趋势方向惩罚项。

## 需求4：财务影响与风险敞口评估（本需求最高可得 12分）
### 标准4.1：高波客户对经营看板的影响（最高可得 6分）
#### 路径4.1.A [6分 | 月度对齐]
- 小标准4.1.A.1 [1分 | 完备性]：定义月度聚合 = 高波客户当月开票额 ÷ 全体开票额，并与 `quickbooks__financial_dashboard` 的同月 `business_health_score`、`collection_rate_percentage`、`collection_per_invoice` 拼接。共对齐 `13` 个月（2024-10 至 2025-10）。
- 小标准4.1.A.2 [4分 | 精确性]：验证平均占比 `30.85%`（允差±0.10pp），占比中位数 `31.11%`，区间 `[22.08%, 39.86%]`。计算皮尔逊相关 `corr(share, health)=-0.3693`、`corr(share, collection)=-0.1507`（允差±0.005）。需示例月度对照（如 2025-03：占比 39.86% → 健康度 82.44，催收率 87.81）。
- 小标准4.1.A.3 [1分 | 结论性]：比较占比高/低两组的均值：`collection_rate` 分别为 `89.66%` vs `88.85%`，`business_health_score` 为 `82.98` vs `83.32`（允差±0.05），并指出高占比轻微拉低健康度的管理含义。

### 标准4.2：资产负债表应收结构解析（最高可得 6分）
#### 路径4.2.A [6分 | Aging 分布]
- 小标准4.2.A.1 [1分 | 完备性]：在 `quickbooks__balance_sheet` 中筛选应收相关 `account_sub_type`（Current/Past Due/Long Overdue），并声明汇总逻辑 `SUM(amount)`。
- 小标准4.2.A.2 [4分 | 精确性]：复核金额与占比：`Current (0-30 days)=78,727,087.46`、`Past Due (31-60 days)=19,691,998.75`、`Past Due (61-90 days)=7,825,769.45`、`Long Overdue (90+ days)=2,771,707.69`，总应收 `109,016,563.35`；对应占比 {72.22%, 18.06%, 7.18%, 2.54%}（金额允差±100，比例允差±0.05pp）。
- 小标准4.2.A.3 [1分 | 结论性]：指出逾期>60天合计占 9.72%，结合高波客户收入占比 30%+，需在风险评分中加入应收老化限制或监控指标。

## 需求5：波动性驱动的多维风险评分与运营策略（本需求最高可得 12分）
### 标准5.1：风险评分公式与阈值（最高可得 6分）
#### 路径5.1.A [6分 | 线性加权]
- 小标准5.1.A.1 [1分 | 完备性]：显式给出评分公式：
  `RiskScore = 0.40·min(CV/0.88094,1) + 0.20·min(Var_qoq/0.50,1) + 0.15·PayPenalty + 0.15·RFMPenalty + 0.10·TrendPenalty`。
  其中 `PayPenalty` 映射 {Excellent=0.00, Good=0.25, Average=0.50, Poor=0.80}，`RFMPenalty` 映射 {Champions=0.20, Loyal=0.40, Potential Loyalists=0.35, New Customers=0.50, Need Attention=0.70, At Risk=0.80, About To Sleep=0.75, Promising=0.45, Hibernating=0.85, Lost=1.00, 其他=0.50}，`TrendPenalty=0.50` 当 `revenue_trend_correlation<0`，否则 0。
- 小标准5.1.A.2 [4分 | 精确性]：复算示例 `CUS92807524262`：`CV=0.88094`、`Var_qoq=0.30727`、`PayPenalty=0.80`、`RFMPenalty=0.70`、`TrendPenalty=0.10` → `RiskScore=0.7479`（允差±0.005）。统计整体均值 `0.2710`、P90 `0.4498`（允差±0.002），并按阈值划分 `{High ≥0.45, Medium 0.30-0.45, Low <0.30}`。需给出分层样本量 `{High:49, Medium:171, Low:481}`（允差±1）。
- 小标准5.1.A.3 [1分 | 结论性]：描述各风险段动作：高风险（≥0.45）触发 7 日内专项复盘 + 应收老化检视；中风险保持半月节奏；低风险维持季度回顾，并记录评分脚本的版本号/运行日志。

### 标准5.2：分群洞察与运营落地（最高可得 6分）
#### 路径5.2.A [6分 | 策略面板]
- 小标准5.2.A.1 [1分 | 完备性]：输出 `{风险段, 主要 RFM, 主要支付行为, n_accounts, avg_CV, avg_Var_qoq}` 面板，注明数据来源（上述评分结果 + 行为标签）。
- 小标准5.2.A.2 [4分 | 精确性]：复核关键锚点：高风险段前二 RFM `{At Risk:17, Need Attention:11}` 与支付 `{Poor:28, Average:20}`；中风险段 `{At Risk:36, Loyal:30, New:29}`；低风险段 `{Champions:109}`。平均 `CV`、`Var_qoq` 需与已验证值一致（允差±0.005）。
- 小标准5.2.A.3 [1分 | 结论性]：形成分段行动建议，例如高风险 → “30 天将重复开票波动从 ≥0.30 拉低至 ≤0.20、应收>60天较基期下降 2pp”，并要求登记责任人、频次与复盘指标（以评分中位数压降为目标）。