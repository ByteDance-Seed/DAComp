# [总分 | 36分] Klaviyo 活动健康度诊断评分标准
---
## 需求1：数据映射、时间窗口与触达频控（本需求最高可得 9分）
### 标准1.1：数据表映射与字段口径对齐
#### 路径1.1.A [5分 | flows+person_campaign_flow 联合映射]
- 小标准1.1.A.1 [1分 | 完备性]：需明示 `klaviyo__flows`→活动聚合层，`klaviyo__person_campaign_flow`→人群触达层，字段映射至少覆盖 `updated_at→occurred_on`、`trigger_type→touch_type`、`variation_id / flow_variation_key→模板ID`、`count_received/opened/clicked_email→KPI`、`touch_span_days / email_open_rate_touch / email_click_to_open_rate_touch / has_converted`→活跃与留存指标；并说明 `source_relation=klaviyo` 单一口径。
- 小标准1.1.A.2 [3分 | 精确性]：映射需与6个月窗口内实际锚点一致：`trigger_type` 分布 API Event=6、List=12、Metric=12、Price Drop=6、Segment=10；全量均值 `open_rate=0.4214±0.005`、`cto_rate=0.2404±0.005`（样本=46）；人群层行数=4，`mean_open_touch=0.6517±0.01`、`mean_c2o_touch=0.431±0.01`；若引入额外字段（如 `count_active_on_site`、`net_revenue_touch`）需说明口径且与上述映射保持一致。
- 小标准1.1.A.3 [1分 | 结论性]：阐述该映射的可行性及局限，例如仅4条 person 记录、收入聚合口径，后续漏斗/留存分析需在聚合层完成，并说明验证方式（SQL 或脚本可复跑）。
#### 路径1.1.B [4分 | flows 单表代理并显式声明限制]
- 小标准1.1.B.1 [1分 | 完备性]：若仅使用 `klaviyo__flows`，需声明 `trigger_type→touch_type`、`variation_id→模板ID`、`updated_at→occurred_on` 的取值范围、`source_relation` 仅为 `klaviyo`，以及 `count_*` 字段均为邮件量级。
- 小标准1.1.B.2 [2分 | 精确性]：需复现与路径1.1.A相同的核心锚点，并新增验证：`DISTINCT variation_id = 24`、模板最大使用次数=2、最高 `use_share≈0.0435±0.001`、最小 `use_share≈0.0217`。
- 小标准1.1.B.3 [1分 | 结论性]：说明缺失 person 层对留存/活跃评估的影响，并提出替代策略（如以模板/触点组合做时间序列监控或回溯 person 表抽样）。
### 标准1.2：时间窗口设定与频控审计
#### 路径1.2.A [4分 | 滚动180天窗口 + 频控校验]
- 小标准1.2.A.1 [1分 | 完备性]：以 `MAX(updated_at)=2023-12-13 17:30:00` 回溯 180 天，明确窗口 `[2023-06-16 17:30:00, 2023-12-13 17:30:00]`，并说明过滤逻辑。
- 小标准1.2.A.2 [2分 | 精确性]：核验锚点：样本量=46、窗口内 `MIN(updated_at)=2023-06-16 22:15:00`、`min_gap_h=61.25±1h`、`avg_gap_h=95.89±1h`、`<24h` 事件数=0、7天滑窗触达次数最大值=3；所有频控结论必须引用上述结果。
- 小标准1.2.A.3 [1分 | 结论性]：总结该窗口与频次校验对后续分析的意义（如验证已满足“≥48h 间隔、7天≤3次”的业务约束）。
#### 路径1.2.B [3分 | 自然月窗口 + 对比说明]
- 小标准1.2.B.1 [1分 | 完备性]：定义自然月窗口为 2023-07-01 至 2023-12-31（含当月向前6个整月），列出各月样本数：7月=8、8月=8、9月=7、10月=8、11月=7、12月=4，总量=42。
- 小标准1.2.B.2 [1分 | 精确性]：在自然月窗口内复算 `min_gap_h=61.25±1h`、`avg_gap_h=95.79±1h`，并说明与滚动窗口差异（允许差异≤1条记录）。
- 小标准1.2.B.3 [1分 | 结论性]：讨论两种窗口对季节性/趋势的影响（如自然月便于配合财报节奏，滚动窗用于实时监控），并说明后续分析采用的主口径。

---
## 需求2：触点识别、KPI 与 Variation 分层（本需求最高可得 12分）
### 标准2.1：触点识别与时间线重建
#### 路径2.1.A [4分 | trigger_type 直接映射触点]
- 小标准2.1.A.1 [1分 | 完备性]：明确 `trigger_type`→触点分类（API Event/List/Metric/Price Drop/Segment），并以 `updated_at` 排序重建时间线。
- 小标准2.1.A.2 [2分 | 精确性]：输出近6个月触点样本数：API Event=6、List=12、Metric=12、Price Drop=6、Segment=10；并说明占比（例如 Segment≈21.7%）。
- 小标准2.1.A.3 [1分 | 结论性]：解读触点分布对后续分析的指引（如 Segment 占比偏高、需关注其后续表现回落）。
#### 路径2.1.B [3分 | flow_name 关键字触点族群]
- 小标准2.1.B.1 [1分 | 完备性]：给出关键字映射策略：`Cart/Browse/Winback→促销`、`Product Discovery→新品`、其余（Welcome/VIP/Seasonal/Post-Purchase）归为“故事化”，并说明维护方式。
- 小标准2.1.B.2 [1分 | 精确性]：复现 46 条样本的类别分布：故事化=24（52.2%）、促销=16（34.8%）、新品=6（13.0%）；若有模糊匹配需阐述归属原则。
- 小标准2.1.B.3 [1分 | 结论性]：比较关键字法与 trigger_type 法的优劣（粒度更细但需人工维护），并说明后续在异常追溯中的使用场景。
### 标准2.2：KPI 计算与 Variation 分层
#### 路径2.2.A [5分 | 变体聚合 + 基线锚点]
- 小标准2.2.A.1 [1分 | 完备性]：说明 `open_rate = count_opened_email ÷ count_received_email`、`cto_rate = count_clicked_email ÷ count_opened_email` 的计算公式，并按 `variation_id` 与 `trigger_type` 聚合。
- 小标准2.2.A.2 [3分 | 精确性]：校验锚点：全窗口均值 `open_rate=0.4214±0.005`、`cto_rate=0.2404±0.005`；各 `trigger_type` 的均值/标准差需与实测一致（API Event `mean_open=0.4879±0.005`、`sd_open=0.027±0.005`、`mean_cto=0.2400±0.005` 等）；模板使用情况：`use_cnt_MAX=2`、`use_share_MAX=0.0435±0.001`，低表现模板示例 `VAR-001 open≈0.325`、`VAR-004 cto≈0.1801`。
- 小标准2.2.A.3 [1分 | 结论性]：指出高/低表现模板与触点的组合特征（如新品触发 + VAR-024 达到 `open≈0.517`），并阐述 Variation 分层对模板治理的意义。
#### 路径2.2.B [3分 | Z 分数 / 稳健排序]
- 小标准2.2.B.1 [1分 | 完备性]：在各 `trigger_type` 内依据 180 天窗口的均值与标准差计算 Z 分数，需说明公式 `(x−μ)/σ`。
- 小标准2.2.B.2 [1分 | 精确性]：列出至少两组锚点：负向代表 `Welcome Series - Variant A (VAR-001)` `z_open≈-1.45±0.05`、`z_cto≈-0.87±0.05`；正向代表 `Browse Abandonment - Variant C (VAR-009)` `z_open≈1.84±0.05`、`z_cto≈1.65±0.05` 及 `VIP Loyalty Track - Variant C (VAR-018)` `z_open≈1.72±0.05`。
- 小标准2.2.B.3 [1分 | 结论性]：说明如何基于 Z 分数构建“次级预警/标杆库”，例如触发 `z_open<-1.5` 时纳入异常复盘清单。
### 标准2.3：触点对后续活动的打开/点击提升
#### 路径2.3.A [4分 | 顺序差异法（LEAD）]
- 小标准2.3.A.1 [1分 | 完备性]：说明以 `updated_at` 排序并使用 `LEAD` 获取下一次活动 KPI，将当前 `trigger_type` 归因给下一次活动。
- 小标准2.3.A.2 [2分 | 精确性]：基于 45 对可比较样本输出锚点：`avg_next_open(API Event)=0.445(+0.0236)`、`Price Drop=0.433(+0.0116)`、`List=0.4381(+0.0166)`、`Metric=0.416(-0.0054)`、`Segment=0.388(-0.0334)`；对应 `avg_next_cto` 变化（Segment `+0.0152`、Metric `-0.0104` 等）。
- 小标准2.3.A.3 [1分 | 结论性]：解读哪些触点对下一次活动的 KPI 有显著提升或拖累，并提出初步假设（如 Segment 后续表现回落需优化模板）。
#### 路径2.3.B [3分 | 回归/因果建模思路]
- 小标准2.3.B.1 [1分 | 完备性]：提出回归方案（如线性回归 `next_open ~ trigger_type + gap_hours + topic` 或 Logit 对 `next_cto`），说明变量口径。
- 小标准2.3.B.2 [1分 | 精确性]：给出模型形式并阐述如何处理小样本（如 L2 正则、分组均值替代），确保系数可解释（`lift = β_trigger_type_i`）。
- 小标准2.3.B.3 [1分 | 结论性]：说明模型输出的业务含义（如在控制 `gap_hours` 后 API Event 系列仍显著为正，支撑扩充触发流）。
#### 路径2.3.C [2分 | 小样本补救策略]
- 小标准2.3.C.1 [1分 | 完备性]：提出当序列样本不足时的补救方案（如对同一触点最近3次活动取移动均值、合并同模板的变体）。
- 小标准2.3.C.2 [1分 | 精确性]：说明补救计算与原始口径一致，并确保 lift 判断方向稳定（需给出公式或伪代码）。

---
## 需求3：路径对比与活跃跨度/留存评估（本需求最高可得 10分）
### 标准3.1：流程→活动 vs 活动→流程 的跨度与留存
#### 路径3.1.A [5分 | person-level 触达跨度]
- 小标准3.1.A.1 [1分 | 完备性]：基于 person 表使用 `last_touch_campaign_id / last_touch_flow_id / has_converted` 区分两条路径，并说明 `touch_span_days` 为跨度指标。
- 小标准3.1.A.2 [3分 | 精确性]：核实锚点：`has_converted=1`（n=3）`avg_days=38±1`、`avg_weeks=5.43±0.1`、`avg_months=1.25±0.05`、`mean_open_touch=0.719±0.01`、`mean_c2o_touch=0.501±0.01`、`avg net_revenue_touch≈326.67`；`has_converted=0`（n=1）`avg_days=27`、`avg_weeks=3.86`、`avg_months=0.89`、`mean_open_touch=0.45`、`mean_c2o_touch=0.222`。
- 小标准3.1.A.3 [1分 | 结论性]：比较两路径在跨度与触达质量上的差异，提出假设（如转化用户保持更长触达周期并贡献更多收入）。
#### 路径3.1.B [4分 | 流程时间序列近似跨度]
- 小标准3.1.B.1 [1分 | 完备性]：在仅有 flows 数据时，说明以 `LEAD/LAG(updated_at)` 推估跨度，结合 48h 频控约束划分 `<96h` vs `≥96h`。
- 小标准3.1.B.2 [2分 | 精确性]：验证 `min_gap_h=61.25±1h`、`avg_gap_h=95.89±1h`，并输出 `gap<96h` 样本=4、`avg_gap_lt96≈77.25`、`gap≥96h` 样本=41、`avg_gap_ge96≈97.71`。
- 小标准3.1.B.3 [1分 | 结论性]：说明时间差法的局限（无法识别用户级行为），并指明需何时回到 person 层验证。
#### 路径3.1.C [3分 | 软路径：跨度分桶]
- 小标准3.1.C.1 [1分 | 完备性]：提出 `touch_span_days≥30` 判定“长跨度”，说明阈值理由（覆盖唯一 72 天样本）。
- 小标准3.1.C.2 [1分 | 精确性]：输出分桶指标：短跨度（n=3）`avg_days=23`、`avg_open_touch=0.657`、`avg_c2o_touch=0.456`；长跨度（n=1）`avg_days=72`、`avg_open_touch=0.636`、`avg_c2o_touch=0.357`。
- 小标准3.1.C.3 [1分 | 结论性]：阐释分桶对识别长线留存用户的意义（如聚焦 VAR-007 的长期维护策略）。
### 标准3.2：频控与 Variation 分层下的留存诊断
#### 路径3.2.A [3分 | 频控合规审查]
- 小标准3.2.A.1 [1分 | 完备性]：说明审查流程需同时检查 48h 间隔与 7 天≤3次两条规则。
- 小标准3.2.A.2 [1分 | 精确性]：引用锚点 `max_7d_cnt=3`、`min_gap_h=61.25`、`avg_gap_h=95.89`，并指出唯一的近距组合来自 `VAR-024→VAR-001`（间隔≈61.25h）与 `VAR-012→VAR-013`（≈93.25h），未低于 48h。
- 小标准3.2.A.3 [1分 | 结论性]：给出“当前合规、建议设定 60h 预警阈值”的结论或指出潜在风险模板。
#### 路径3.2.B [2分 | Variation×路径 联动]
- 小标准3.2.B.1 [1分 | 完备性]：展示按 `variation_id` 关联 person 指标的做法（如统计 `touch_span_days`、`email_open_rate_touch`）。
- 小标准3.2.B.2 [1分 | 精确性]：至少列举两支模板：`VAR-001 touch_span_days=20、open_touch=0.833`、`VAR-010 touch_span_days=27、open_touch=0.45（has_converted=0）`，说明其留存差异。

---
## 需求4：频控监测与编排优化建议（本需求最高可得 5分）
### 标准4.1：诊断总结与优化建议
#### 路径4.1.A [5分 | 基于证据的建议闭环]
- 小标准4.1.A.1 [1分 | 完备性]：输出结构化诊断（触点分布、KPI 基线、顺序 lift、跨度/留存、频控结果），覆盖核心发现。
- 小标准4.1.A.2 [3分 | 精确性]：建议需引用前述量化结果并保持一致：如 “API Event 下一次打开率 +0.0236”、“Segment 下一次打开率 -0.0334 且点击率仅 +0.0152”、“VAR-001 打开/点击低于基线”、“has_converted=1 组跨度=38 天、净收入≈326.7” 等；同时指出模板复用率最高仅 4.35%，需通过绩效驱动而非频次限制。
- 小标准4.1.A.3 [1分 | 结论性]：提出至少两类可执行动作，含预期指标或收益区间，例如：
  1. “针对 Segment 触点引入高绩效模板（如 VAR-018）并优先安排周末下午发送，目标下一次打开率恢复至 ≥0.42、点击率提升 2–5%。”
  2. “扩展 API Event 流并保持 ≥60h 间隔，结合新品模板 VAR-024 做 A/B，对标 +0.0236 打开率增幅，目标点击率再提升 2–4%。”
#### 路径4.1.B [3分 | 提升方案 + 实验设计]
- 小标准4.1.B.1 [1分 | 完备性]：提出至少1个 A/B 或多臂实验方案，明确实验指标（打开率/点击率/留存）与观察周期。
- 小标准4.1.B.2 [1分 | 精确性]：实验假设需引用数据（如新品触点均值 0.4879，预期通过调整发送至工作日上午 10:00 提升至 0.512（+5%）并带动点击率 +2–5%），并说明样本量或分流策略（如 50/50 分流、需 ≥6 场活动）。
- 小标准4.1.B.3 [1分 | 结论性]：阐述实验成功判据与推广路径（达成目标后更新模板库、节奏入标准流程）。