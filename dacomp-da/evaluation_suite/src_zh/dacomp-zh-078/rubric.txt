# [总分 | 36分] 客户价值多维评估与3–6个月趋势预测评分标准
---
## 需求1：数据准备、时间窗与标签构建（本需求最高可得 9分）
### 标准1.1：数据资产梳理与可用性确认（最高3分）
#### 路径1.1.A [3分 | 表结构盘点+主键映射]
- 小标准1.1.A.1 [1分 | 完备性]：需列出并描述`pendo__account`（账户画像/活跃聚合，主键`account_id`）、`pendo__visitor`（访客画像与`account_id`映射）、`pendo__visitor_daily_metrics`（日级强度/频次，主键`(visitor_id,date_day)`）、`pendo__feature`（功能字典，`feature_id`）、`pendo__visitor_feature`（访客×功能使用，主键`(visitor_id,feature_id)`）的字段作用与连接方式。必须明确后续特征均通过`pendo__visitor`完成`visitor_id→account_id`的级联。
- 小标准1.1.A.2 [1分 | 精确性]：提供可复现 SQL 输出：`pendo__account=1000`、`pendo__visitor=38,544`、`pendo__visitor_daily_metrics=29,057`、`pendo__feature=2,000`、`pendo__visitor_feature=24,982`；`date_day`最小值`2024-01-04`、最大值`2024-09-28`；`pendo__visitor_feature`的`first_click_at`最小`2021-01-01 02:57:15.258 +0800`、`last_click_at`最大`2024-12-30 23:55:24.868 +0800`。
- 小标准1.1.A.3 [1分 | 结论性]：基于统计结论指出：`pendo__visitor_daily_metrics`与`pendo__visitor_feature`可支持过去/未来窗口特征；但`2024-07-01~2024-09-28`未来窗口仅覆盖`33`名访客、`2`个账户，若坚持账户级训练会严重稀疏，需转向访客级或延长未来窗口。

#### 路径1.1.B [3分 | 活跃覆盖与样本量诊断]
- 小标准1.1.B.1 [1分 | 完备性]：说明未来活跃量统计逻辑：先在`pendo__visitor_daily_metrics`按`date_day`去重访客，再按`strftime('%Y-%m',date_day)`聚合，最后联结`pendo__visitor`映射到账户。
- 小标准1.1.B.2 [1分 | 精确性]：给出验证结果：月度活跃账户数（`2024-01`=11、`2024-02`=11、`2024-03`=9、`2024-04~2024-06`=5、`2024-07`=2、`2024-08`=1、`2024-09`=1）；滚动窗口示例（去重访客/账户）：`2024-01~02→2024-03`访客533/账户9，`2024-02~03→2024-04`访客394/账户5，`2024-03~04→2024-05`访客240/账户5，`2024-04~05→2024-06`访客92/账户5，`2024-05~06→2024-07`访客33/账户2，`2024-06~07→2024-08`访客23/账户1。
- 小标准1.1.B.3 [1分 | 结论性]：明确指出：未来窗口（`2024-07`及以后）账户覆盖骤降→后续建模需采用访客粒度叠加滚动样本（共`3,046`条记录），否则训练/评估无法稳定。

### 标准1.2：时间窗划分与防泄露（最高3分）
#### 路径1.2.A [3分 | 固定窗口方案]
- 小标准1.2.A.1 [1分 | 完备性]：规定核心评估窗口：过去`2024-04-01~2024-06-30`，未来`2024-07-01~2024-09-28`。需报告过去窗口活跃访客`394`、账户`5`；未来窗口活跃访客`33`、账户`2`。
- 小标准1.2.A.2 [1分 | 精确性]：验证脚本须仅依赖过去窗口内的`sum_minutes/sum_events/count_features_clicked`等日级字段，严禁跨窗字段（如`last_event_on`、终身累计）参与特征构建。
- 小标准1.2.A.3 [1分 | 结论性]：给出可量化判断：由于未来窗口仅2个账户，固定窗口账户级模型风险过高，需转访客级或延长未来窗口（例如叠加`2024-10`数据）方可上线。

#### 路径1.2.B [3分 | 滚动窗口方案]
- 小标准1.2.B.1 [1分 | 完备性]：至少列出六组滚动窗口：`W1:2024-01-01~02-29→03`、`W2:2024-02-01~03-31→04`、`W3:2024-03-01~04-30→05`、`W4:2024-04-01~05-31→06`、`W5:2024-05-01~06-30→07`、`W6:2024-06-01~07-31→08`。
- 小标准1.2.B.2 [1分 | 精确性]：输出滚动窗口统计：`W1`访客数875/未来活跃533、`W2`=898/394、`W3`=547/240、`W4`=394/92、`W5`=240/33、`W6`=92/23；同时给出未来分钟总量（如`W1`=24,286分钟）。
- 小标准1.2.B.3 [1分 | 结论性]：提出实施策略：叠加六个窗口共`3,046`样本，用于时间序列交叉验证；说明`W5`、`W6`需配合访客级标签或上采样以缓解后期稀疏。

### 标准1.3：高价值标签构建（最高3分）
#### 路径1.3.A [3分 | Top-K与多指标结合]
- 小标准1.3.A.1 [1分 | 完备性]：定义高价值=未来窗口`future_minutes`按窗口分组的前10%（CS资源聚焦前十分位）；同时约定多指标90分位白名单（未来分钟、未来事件、未来功能点击、未来活跃日）。
- 小标准1.3.A.2 [1分 | 精确性]：提供精确阈值——Top10%分钟阈值：`W1≥51`、`W2≥42`、`W3≥63`、`W4≥48`、`W5≥67`、`W6≥107`（对应正样本分别为89/90/55/40/24/11人，需使用`>=阈值`处理并解释平局）；90分位多指标阈值：`W1`(分钟51/事件118/点击7/活跃日17)、`W2`(41/95/4/18)、`W3`(62/132/10/11)、`W4`(47/80/10/5)、`W5`(38/62/3/5)、`W6`(107/173/19/6)。
- 小标准1.3.A.3 [1分 | 结论性]：输出标签分布并解释：前四个窗口正样本约10%且分钟阈值>40，`W5`、`W6`虽维持10%抽样但总体使用时长锐减（平均未来分钟仅29.18），后续模型需结合动量/广度特征并监控高价值阈值是否持续下降。

---
## 需求2：多维特征构建与高价值识别模型（本需求最高可得 12分）
### 标准2.1：特征体系设计（最高4分）
#### 路径2.1.A [4分 | 五维度行为框架]
- 小标准2.1.A.1 [1分 | 完备性]：需构建至少五类特征并给出实例：强度（`past_minutes`、`past_events`）、广度（`past_feature_clicks`、Jan-Feb窗口访客平均功能数≈1.06）、稳定性/粘性（`past_active_days`、`minutes_per_active_day`）、动量（`minutes_delta`、`last_month_minutes`）、关系健康（`latest_nps_rating`、`count_associated_visitors`）。
- 小标准2.1.A.2 [1分 | 精确性]：验证口径：`W1`平均`past_minutes=69.0`、`past_events=145.85`、`past_active_days=12.02`、`feature_click_rate=1.206`；`W6`平均`past_minutes=177.36`、`past_events=288.15`、`past_active_days=17.24`、`feature_click_rate=1.368`。须说明缺失`latest_nps_rating`占比32.24%，默认填充0或单独缺失指示。
- 小标准2.1.A.3 [1分 | 结论性]：陈述业务洞察：早期窗口动量（`minutes_delta`）为正，`W4~W6`改为负（`W5`均值-14.25），显示整体衰退；NPS对未来分钟的Spearman（`W6`=0.464）显示中等影响，需留作分层解释。
- 小标准2.1.A.4 [1分 | 精确性]：提供核验脚本（或等价代码）：对任一窗口过滤`date_day`后按访客聚合，再计算`minutes_per_active_day=past_minutes/past_active_days`、`minutes_delta=last_month_minutes-first_month_minutes`，确保与上表均值对齐。

#### 路径2.1.B [4分 | 嵌入/聚类特征]
- 小标准2.1.B.1 [1分 | 完备性]：说明构建功能使用矩阵步骤：以`pendo__visitor_feature`中`last_click_at`落在过去窗口的`(visitor_id,feature_id,sum_clicks)`为矩阵元素，必要时结合`pendo__feature.is_core_event`形成列白名单。
- 小标准2.1.B.2 [1分 | 精确性]：提交实现流程（矩阵归一化→SVD/UMAP或KMeans降维/聚类→生成嵌入向量/簇标签），并确保仅使用过去窗口数据（例如Jan-Feb内`956`名访客具备功能点击）。
- 小标准2.1.B.3 [1分 | 结论性]：解释嵌入/聚类产出，例如高点击簇集中在`app_platform='web'`且后续未来分钟均值>60，揭示偏好场景。
- 小标准2.1.B.4 [1分 | 精确性]：提供验证逻辑：统计各簇的核心功能使用率/未来分钟均值，若差异>20分钟视为有效特征。

#### 路径2.1.C [4分 | 严格过去窗白名单]
- 小标准2.1.C.1 [1分 | 完备性]：列出纳入模型的字段清单，限定在`past_*`、动量、NPS、嵌入特征；必须显式剔除`last_event_on`、生命周期累计等跨窗字段。
- 小标准2.1.C.2 [1分 | 精确性]：给出检查脚本：在建模数据集中核对所有时间列≤过去窗口结束日，或通过字段命名（`past_`前缀）实现自动校验。
- 小标准2.1.C.3 [1分 | 结论性]：阐述严格白名单的意义：在`W1→W6`滚动验证中可避免夸张的AUC（实测平均AUC 0.9458，未见异常高值）。
- 小标准2.1.C.4 [1分 | 精确性]：展示抽样核查结果：随机抽取10条访客记录，重算过去窗口分钟/事件与特征表一致。

### 标准2.2：价值评分/模型构建（最高5分）
#### 路径2.2.A [5分 | 监督分类模型]
- 小标准2.2.A.1 [1分 | 完备性]：说明采用`GradientBoostingClassifier(random_state=42)`，训练集`W1~W5`、测试集`W6`，输入特征为2.1C白名单，标签为Top10%分钟高价值。
- 小标准2.2.A.2 [1分 | 精确性]：描述训练流程——特征零填充、类别不平衡由模型内置处理、滚动交叉验证（折次：`W1→W2`…`W5→W6`）。
- 小标准2.2.A.3 [1分 | 精确性]：报告验证指标：五折结果（Accuracy/Precision/Recall/F1/AUC）分别为`0.9009/0.5054/0.6444/0.5678/0.8873`、`0.9122/0.5593/0.7455/0.6383/0.9500`、`0.9594/0.8158/0.7500/0.7816/0.9839`、`0.95/0.7/0.625/0.6615/0.9819`、`0.8370/0.4167/0.9091/0.5714/0.9259`。
- 小标准2.2.A.4 [1分 | 结论性]：相较仅用时长+频次的Logistic基线（Precision=0.3235、Recall=1.0、AUC=0.9248），新模型在Precision上提升≥9.3pp；在测试集将阈值调至`0.91`可得到Precision=1.0、Recall=0.1818、Accuracy=0.9022，已满足Precision≥0.85目标。
- 小标准2.2.A.5 [1分 | 精确性]：展示特征重要性（训练集）：`past_minutes`0.439、`minutes_delta`0.159、`past_active_days`0.137、`minutes_per_active_day`0.118、`feature_click_rate`0.069、`past_events`0.052、`past_feature_clicks`0.017、`latest_nps_rating`0.009，并解释强度与动量为关键驱动。

#### 路径2.2.B [5分 | 相关性加权评分]
- 小标准2.2.B.1 [1分 | 完备性]：定义评分`Score = Σ z_i × ρ_i`，其中`z_i`为训练集Z-score，`ρ_i`为Spearman相关（`past_minutes`0.283、`past_events`0.230、`past_active_days`0.351、`past_feature_clicks`0.127、`minutes_delta`0.353、`latest_nps_rating`-0.045）。
- 小标准2.2.B.2 [1分 | 精确性]：说明计算步骤（标准化→加权求和→阈值选取）。实测`Score`在训练正样本的75分位阈值为`1.465`。
- 小标准2.2.B.3 [1分 | 结论性]：在`W6`上，阈值1.465时Precision=0.5、Recall=0.3636、AUC=0.9394，相比旧模型的Precision=0.3235存在可解释性与性能双改进。
- 小标准2.2.B.4 [1分 | 精确性]：提供校验方式：绘制`Score`与未来分钟的Spearman（实测0.56）和分箱单调性（score升高→未来分钟均值单调上升）。
- 小标准2.2.B.5 [1分 | 结论性]：指出权重可按月重新计算Spearman以适应漂移，并作为轻量备选方案。

#### 路径2.2.C [5分 | 规则分数+监督校准]
- 小标准2.2.C.1 [1分 | 完备性]：构建规则分`0.35*past_minutes+0.2*past_events+0.2*past_active_days+0.15*past_feature_clicks+0.1*minutes_delta`；再以规则分+原始特征输入`Logistic(class_weight='balanced')`。
- 小标准2.2.C.2 [1分 | 精确性]：在`W6`上阈值选取0.92时Precision=0.4615、Recall=0.5455、AUC=0.9181；需给出训练集规则分分布及校准系数。
- 小标准2.2.C.3 [1分 | 精确性]：验证流程包括规则分排序、监督模型概率输出与Precision/Recall对比；确认两者排序Spearman≥0.55。
- 小标准2.2.C.4 [1分 | 结论性]：总结两段式优势：规则分便于SOP落地，监督模型用于概率校准；推荐上线时以监督概率为准并保留规则分作人工兜底。
- 小标准2.2.C.5 [1分 | 精确性]：提供时间切分校验：训练`W1~W4`、验证`W5`、测试`W6`，确保规则分仅取过去窗口字段。

### 标准2.3：识别效果验证与目标达成（最高3分）
#### 路径2.3.A [3分 | 分类评估]
- 小标准2.3.A.1 [1分 | 完备性]：报告测试集（`W6`）指标：Accuracy=0.8369、Precision=0.4167、Recall=0.9091、F1=0.5714、AUC=0.9259、混淆矩阵`[[55,26],[1,10]]`（阈值0.5），并说明训练-验证切分。
- 小标准2.3.A.2 [1分 | 精确性]：阐明阈值调整结果：阈值0.91→混淆矩阵`[[81,0],[9,2]]`，Precision=1.0≥0.85；对比旧模型Precision=0.3235。
- 小标准2.3.A.3 [1分 | 结论性]：总结新模型提升来自动量/粘性维度，并给出阈值策略（生产推荐0.91保精准，0.5用于广覆盖）。

#### 路径2.3.B [3分 | Top-K识别率]
- 小标准2.3.B.1 [1分 | 完备性]：定义未来Top10%分钟为真值，计算模型Score的Top-K命中率。
- 小标准2.3.B.2 [1分 | 精确性]：`W6`上Gradient Boosting的Precision@K：`K=1/2`均为1.0、`K=3`=0.667、`K=10`=0.6；需提供排序及标注窗口ID。
- 小标准2.3.B.3 [1分 | 结论性]：指出Top-K在资源有限场景下可聚焦前2名客户必中，若需覆盖前10名则Precision≈0.6，需要CS人工复核或更高阈值。

---
## 需求3：未来3–6个月价值趋势预测（本需求最高可得 9分）
### 标准3.1：趋势标签定义与样本构建（最高3分）
#### 路径3.1.A [3分 | 比率阈值法]
- 小标准3.1.A.1 [1分 | 完备性]：以3个月窗口为准：过去`2024-01-01~03-31`对未来`2024-04-01~06-30`（T1），及滚动`2024-02-01~04-30`→`2024-05-01~07-31`（T2）；定义增长≥1.2，下降≤0.9，其余为持平。
- 小标准3.1.A.2 [1分 | 精确性]：提供标签分布：`T1`增长163/持平37/下降799，`T2`增长37/持平10/下降865；需说明0值处理为+1e-6防止除零。
- 小标准3.1.A.3 [1分 | 结论性]：指出极度不平衡（下降>80%）会导致宏F1偏低，后续建模需引入采样或聚焦下降风险。

#### 路径3.1.B [3分 | 连续目标+分段]
- 小标准3.1.B.1 [1分 | 完备性]：构建回归目标`future_minutes`，再按增长阈值映射为趋势类别。
- 小标准3.1.B.2 [1分 | 精确性]：`Ridge(alpha=1.0)`在`T3`测试集（未来`2024-06-01~08-31`）：`R²=0.024`、`MAE=66.52`，需记录`MAPE`因零值过大（约`1.9e17`）并说明需做偏移处理。
- 小标准3.1.B.3 [1分 | 结论性]：明确回归预测直接映射效果差，仅适合生成连续指标后再选动量阈值；建议结合加1平滑或对数变换。

#### 路径3.1.C [3分 | 访客级趋势→账户聚合]
- 小标准3.1.C.1 [1分 | 完备性]：说明流程：先在访客级打`trend_3m`标签，再按账户聚合（均值概率、下降占比）。
- 小标准3.1.C.2 [1分 | 精确性]：给出`T3`聚合示例：`ACC00000007`访客118人、下降占比≈100%、平均下降概率0.597；`ACC00000006`137人/0.578；`ACC00000009`106人/0.567。
- 小标准3.1.C.3 [1分 | 结论性]：阐述账户聚合可定位集中风险客户，为CS制定批量拯救策略。

### 标准3.2：趋势预测建模与评估（最高4分）
#### 路径3.2.A [4分 | 监督分类模型]
- 小标准3.2.A.1 [1分 | 完备性]：采用`Logistic(class_weight='balanced')`预测“下降=1”，训练`T1+T2`、测试`T3`，输入`past_minutes/events/feature_clicks/active_days/latest_nps_rating`。
- 小标准3.2.A.2 [1分 | 精确性]：测试集结果：Accuracy=0.6618、Precision=0.9722、Recall=0.6667、F1=0.7910、混淆矩阵`[[14,8],[175,350]]`（访客总547，下降525）。
- 小标准3.2.A.3 [1分 | 精确性]：指出模型在极度不平衡下仍满足Accuracy≥0.70要求不适用，改以Precision/F1验证；若未达标需说明采样或特征拓展计划。
- 小标准3.2.A.4 [1分 | 结论性]：解释应用：高Precision保证下降名单可信，可用于提前预警并结合账户聚合排名。

#### 路径3.2.B [4分 | 回归+阈值分类]
- 小标准3.2.B.1 [1分 | 完备性]：沿用3.1.B回归，设置增长/持平/下降阈值（1.2/0.9）。
- 小标准3.2.B.2 [1分 | 精确性]：回归输出转分类在`T3`准确率≈0.42、宏F1≈0.28；需给出阈值选择依据（如按训练集分位）。
- 小标准3.2.B.3 [1分 | 结论性]：说明回归虽R²低但可辅助估计未来分钟绝对量，适合作为趋势模型的连续输入。
- 小标准3.2.B.4 [1分 | 精确性]：强调回归特征仅取过去窗口，提供核查脚本（过滤`date_day<=past_end`）。

#### 路径3.2.C [4分 | 时间序列/平滑模型]
- 小标准3.2.C.1 [1分 | 完备性]：提出简化时间序列方法：以过去两个月构建线性趋势（`minutes_delta`）、或使用最近30日滑动均值。
- 小标准3.2.C.2 [1分 | 精确性]：验证`last_month_minutes`直接外推的`R²`：`W1`=-0.586、`W2`=-0.314、`W3`=0.233、`W4`=-0.449、`W5`=-1.521、`W6`=-7.80。
- 小标准3.2.C.3 [1分 | 结论性]：指出除`W3`外大部分窗口预测力为负，时间序列仅适用于活跃度稳定期（`W3`）。
- 小标准3.2.C.4 [1分 | 精确性]：建议核对方法：为每名访客输出过去两月线性拟合系数，检验与未来分钟Spearman（`W6`约0.19）并筛查异常。

### 标准3.3：趋势输出与运营应用（最高2分）
#### 路径3.3.A [2分 | 账户级聚合与分层]
- 小标准3.3.A.1 [1分 | 完备性]：基于3.2.A概率输出，形成账户趋势表：字段须含`account_id`、访客数、下降概率均值、下降访客占比。
- 小标准3.3.A.2 [1分 | 结论性]：给出运营建议：对`ACC00000007/06/09/03/04`这类下降概率>0.55的账户，建议在30天内启动深度回访或功能再激活。

#### 路径3.3.B [2分 | 风险清单与行动]
- 小标准3.3.B.1 [1分 | 完备性]：输出`prob>=0.8`的访客清单（实测10人，如`VIS0000000199`概率0.904），附主要驱动特征（如过去分钟不足10但骤降≥80%）。
- 小标准3.3.B.2 [1分 | 结论性]：明确行动：目标提升这些账户未来3个月留存，措施包括续约提醒、功能教育、异常使用排查；需阐明预期（如将下降概率降至<0.4）。

---
## 需求4：模型稳健性、可解释性与落地治理（本需求最高可得 6分）
### 标准4.1：防止信息泄露与阈值治理（最高3分）
#### 路径4.1.A [3分 | 时间分割与泄露审计]
- 小标准4.1.A.1 [1分 | 完备性]：说明时间切分策略：训练`W1~W5`、测试`W6`；趋势模型训练`T1~T2`、测试`T3`；特征严格来自过去窗口。
- 小标准4.1.A.2 [1分 | 精确性]：提供审计报告：检查特征字段命名前缀`past_`；滚动验证五折Accuracy均≤0.96且AUC均≤0.984，无异常高值；如发现>0.99需回查漏泄。
- 小标准4.1.A.3 [1分 | 结论性]：定义异常处理流程：若精度异常升高，需重算特征窗口或移除潜在泄露字段后重新训练。

#### 路径4.1.B [3分 | 概率校准与阈值策略]
- 小标准4.1.B.1 [1分 | 完备性]：采用Isotonic校准`CalibratedClassifierCV`；记录原模型与校准后Brier分数。
- 小标准4.1.B.2 [1分 | 精确性]：实测`W6`：Brier(base)=0.1035，Brier(isotonic)=0.0812；Precision-Recall曲线首个≥0.85 Precision点对应阈值0.91。
- 小标准4.1.B.3 [1分 | 结论性]：制定监控：每月复核Precision@阈值、Brier分数与数据漂移（窗口样本对比KS/PSI），阈值异常则重训或回调至0.5。

### 标准4.2：可解释性与运营落地（最高3分）
#### 路径4.2.A [3分 | 特征驱动与运营闭环]
- 小标准4.2.A.1 [1分 | 完备性]：输出特征重要性Top8及数值（2.2.A.5），并覆盖强度、动量、稳定性、关系维度。
- 小标准4.2.A.2 [1分 | 精确性]：解释关键驱动：`past_minutes`与`minutes_delta`共同解释>0.59的总重要性；`latest_nps_rating`虽权重低但与未来价值Spearman在`W6`达到0.464，适合作运营提醒。
- 小标准4.2.A.3 [1分 | 结论性]：制定闭环：高价值→扩容方案；潜力但低动量→功能培育；低NPS→CS介入。

#### 路径4.2.B [3分 | 分层策略与监控清单]
- 小标准4.2.B.1 [1分 | 完备性]：定义分层：`P>=0.91`高价值（精准名单）、`0.6≤P<0.91`培育层、`P<0.6`常规层；趋势下降概率≥0.8纳入风险池。
- 小标准4.2.B.2 [1分 | 精确性]：说明分层与指标对齐：`Precision@1/2`=1.0支撑重点攻坚；Spearman(预测,未来分钟)=0.579验证排序有效；风险层参考下降概率均值>0.55的账户列表。
- 小标准4.2.B.3 [1分 | 结论性]：构建监控闭环：月度跟踪Precision@10、Brier、Spearman、趋势下降命中率；若连续2期劣化>10pp须重新评估特征或阈值。